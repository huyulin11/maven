<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.calculatedfun.dao.AppEmployeeMapper" >
	<select id="selectAllResourcess" resultType="com.calculatedfun.bean.ResourceBean">
		SELECT *
		from ${@com.kaifantech.init.sys.dao.AppTables@LY_RESOURCES} where ishide = 0 
		order by sortflag
	</select>
    <!-- Employee -->
 	<select id="selectEmployee" resultType="com.calculatedfun.dto.Employee" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Apr 17 
			11:42:25 CST 2013. -->
		select * from employee where id = #{employeeId,jdbcType=INTEGER}
	</select>
	<select id="selectEmployeeByuserid" resultType="com.calculatedfun.dto.Employee" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Wed Apr 17 
			11:42:25 CST 2013. -->
		select * from employee where id = #{userid,jdbcType=INTEGER}
	</select>
	<select id="updatepassword" parameterType="com.calculatedfun.dto.Employee">
		update employee set password=#{password,jdbcType=VARCHAR} where id = #{employeeId,jdbcType=INTEGER}
	</select>
	<select id="getEmpAuthorization" resultType="java.lang.Integer" parameterType="java.lang.String">
		select menuid from employee_authorization 
		where roleid in
		  <foreach item="item" index="index" collection="roleArr"
    		open="(" separator="," close=")">
    		#{item}
  		  </foreach>
	</select>
	<select id="getEmployeeMenu" resultType="com.calculatedfun.dto.EmployeeMenu" parameterType="java.lang.Integer">
		select * from employee_menu 
		where id in
		  <foreach item="item" index="index" collection="empAuthList"
    		open="(" separator="," close=")">
    		#{item}
  		  </foreach>
  		 ORDER BY serialnumber
	</select>
	<!--  Stock -->
	 <select id="selectStockSelList" resultType="com.calculatedfun.bean.StockSel" parameterType="com.calculatedfun.bean.StockSel" >
    select * from ((select st.id,st.stockno,st.postion,st.remark,st.acceptid,st.accepttime,st.sendid,st.type,re.sendtype,
    	case    
				when re.internalstates='0' then '待处理'  
        		when re.internalstates='1' then '受理中'
				when re.internalstates='2' then '待确认'
				when re.internalstates='3' then '受理结束'
				when re.internalstates='4' then '制图中'
				when re.internalstates='5' then '制图结束'
				when re.internalstates='6' then '评级中'
				when re.internalstates='7' then '评级结束'
				when re.internalstates='8' then '打盒中'
				when re.internalstates='9' then '打盒结束'
				when re.internalstates='10' then '打盒制图中'
				when re.internalstates='11' then '打盒制图结束'  
				when re.internalstates='12' then '入库'
        		else '--' END  as internalstates,
		case    
				when re.requeststatus='0' then '草稿'
				when re.requeststatus='1' then '已提交'
				when re.requeststatus='2' then '受理中'
				when re.requeststatus='3' then '待确认'
				when re.requeststatus='4' then '待支付'
				when re.requeststatus='5' then '评级中'
				when re.requeststatus='6' then '待发货'
				when re.requeststatus='7' then '发货'
				else '--' END  as requeststatus,re.remark as reqremark,re.notice,st.notifytimes
	from stock st LEFT JOIN request_main re
	on st.stockno=re.requestcode 
	where st.stockno!=''
		and st.type='R'
		<if test="requeststatus!=-1">
			and re.requeststatus=#{requeststatus,jdbcType=VARCHAR}
		</if>
		<if test="id != null and id != ''">
	      and st.id =#{id,jdbcType=VARCHAR}
	    </if>
	    <if test="postion != null and postion != ''">
	      and st.postion =#{postion,jdbcType=VARCHAR}
	    </if>
	    <if test="remark != null and remark != ''">
	      and st.remark =#{remark,jdbcType=VARCHAR}
	    </if>
	    <if test="acceptid != null and acceptid != ''">
	      and st.acceptid =#{acceptid,jdbcType=INTEGER}
	    </if>
	    <if test="accepttime != null and accepttime != ''">
	      and st.accepttime =#{accepttime,jdbcType=TIMESTAMP}
	    </if>
	    <if test="sendid != null and sendid != ''">
	      and st.sendid =#{sendid,jdbcType=INTEGER}
	    </if>
	    <if test="type != null and type != ''">
	      and st.type =#{type,jdbcType=CHAR}
	    </if>
	    <if test="stockno != null and stockno != '' and stockno !='-1' and stockno !='-2'">
	      and st.stockno =#{stockno,jdbcType=VARCHAR}
	    </if>
		)
	UNION all (
	select sk.id,sk.stockno,sk.postion,sk.remark,sk.acceptid,sk.accepttime,sk.sendid,sk.type,'','','','','',''
	from stock sk where sk.type='P'
		<if test="id != null and id != ''">
	      and sk.id =#{id,jdbcType=VARCHAR}
	    </if>
	    <if test="postion != null and postion != ''">
	      and sk.postion =#{postion,jdbcType=VARCHAR}
	    </if>
	    <if test="remark != null and remark != ''">
	      and sk.remark =#{remark,jdbcType=VARCHAR}
	    </if>
	    <if test="acceptid != null and acceptid != ''">
	      and sk.acceptid =#{acceptid,jdbcType=INTEGER}
	    </if>
	    <if test="accepttime != null and accepttime != ''">
	      and sk.accepttime =#{accepttime,jdbcType=TIMESTAMP}
	    </if>
	    <if test="sendid != null and sendid != ''">
	      and sk.sendid =#{sendid,jdbcType=INTEGER}
	    </if>
	    <if test="type != null and type != ''">
	      and sk.type =#{type,jdbcType=CHAR}
	    </if>
	    <if test="stockno != null and stockno != '' and stockno !='-1' and stockno !='-2'">
	      and sk.stockno =#{stockno,jdbcType=VARCHAR}
	    </if>
	)) hh
	<if test="requestcode != null and requestcode != ''">
		where stockno = #{requestcode,jdbcType=VARCHAR}
	</if>
    <if test="sortid != null and sortid != ''">
     order by id
    </if>
    <if test="sortpostion != null and sortpostion != ''">
     order by postion
    </if>
    <if test="sortremark != null and sortremark != ''">
     order by remark
    </if>
    <if test="sortacceptid != null and sortacceptid != ''">
     order by acceptid
    </if>
    <if test="sortaccepttime != null and sortaccepttime != ''">
     order by accepttime
    </if>   
    <if test="sortsendid != null and sortsendid != ''">
     order by sendid
    </if>
    <if test="sorttype != null and sorttype != ''">
     order by type
    </if>
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
   	 limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}
  </select>
  <update id="updateSendtimes" parameterType="java.lang.String">
  	update stock set notifytimes=notifytimes+1 where stockno = #{stockno,jdbcType=VARCHAR}
  </update>
	 <select id="selectStockList" resultType="com.calculatedfun.bean.StockSel" parameterType="com.calculatedfun.bean.StockSel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select * from stock
    where stockno =''
    <if test="id != null and id != ''">
      and id =#{id,jdbcType=VARCHAR}
    </if>
    <if test="postion != null and postion != ''">
      and postion =#{postion,jdbcType=VARCHAR}
    </if>
    <if test="remark != null and remark != ''">
      and remark =#{remark,jdbcType=VARCHAR}
    </if>
    <if test="acceptid != null and acceptid != ''">
      and acceptid =#{acceptid,jdbcType=INTEGER}
    </if>
    <if test="accepttime != null and accepttime != ''">
      and accepttime =#{accepttime,jdbcType=TIMESTAMP}
    </if>
    <if test="sendid != null and sendid != ''">
      and sendid =#{sendid,jdbcType=INTEGER}
    </if>
    <if test="type != null and type != ''">
      and type =#{type,jdbcType=CHAR}
    </if>
    <if test="stockno != null and stockno != '' and stockno !='-1' and stockno !='-2'">
      and stockno =#{stockno,jdbcType=VARCHAR}
    </if>
    <if test="sortid != null and sortid != ''">
     order by id
    </if>
    <if test="sortpostion != null and sortpostion != ''">
     order by postion
    </if>
    <if test="sortremark != null and sortremark != ''">
     order by remark
    </if>
    <if test="sortacceptid != null and sortacceptid != ''">
     order by acceptid
    </if>
    <if test="sortaccepttime != null and sortaccepttime != ''">
     order by accepttime
    </if>   
    <if test="sortsendid != null and sortsendid != ''">
     order by sendid
    </if>
    <if test="sorttype != null and sorttype != ''">
     order by type
    </if>
<!--     <if test="sortstockno != null and sortstockno != ''"> -->
<!--      order by stockno -->
<!--     </if> -->
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
   	 limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}
  </select>
  <select id="getStockListCount" parameterType="com.calculatedfun.dto.Stock" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select count(*) from stock st LEFT JOIN request_main rm ON st.stockno=rm.requestcode
   	where 1=1 
   	 <if test="requeststatus !=-1">
   	 	and rm.requeststatus = #{requeststatus,jdbcType=VARCHAR}
   	 </if>
   	 <if test="requestcode !=null and requestcode != ''">
   	 	and st.stockno = #{requestcode,jdbcType=VARCHAR}
   	 </if>
   	 <if test="id != null and id != ''">
      and st.id =#{id,jdbcType=VARCHAR}
    </if>
    <if test="postion != null and postion != ''">
      and st.postion =#{postion,jdbcType=VARCHAR}
    </if>
    <if test="remark != null and remark != ''">
      and st.remark =#{remark,jdbcType=VARCHAR}
    </if>
    <if test="acceptid != null and acceptid != ''">
      and st.acceptid =#{acceptid,jdbcType=INTEGER}
    </if>
    <if test="accepttime != null and accepttime != ''">
      and st.accepttime =#{accepttime,jdbcType=TIMESTAMP}
    </if>
    <if test="sendid != null and sendid != ''">
      and st.sendid =#{sendid,jdbcType=INTEGER}
    </if>
    <if test="type != null and type != ''">
      and st.type =#{type,jdbcType=CHAR}
    </if>
    <if test="stockno != null and stockno != '' and stockno !='-1' and stockno !='-2'">
      and st.stockno =#{stockno,jdbcType=VARCHAR}
    </if>
    <if test="stockno =='-1'">
      and st.stockno !=''
    </if>
    <if test="stockno =='-2'">
      and st.stockno =''
    </if>
  </select>
  <select id="getInternalstates" resultType="java.lang.String">
      select internalstates 
      from request_main
      where requestcode = #{requestcode,jdbcType=INTEGER}
  </select>
  <update id="updateStock" parameterType="com.calculatedfun.dto.Stock" >
      update stock
      set stockno = #{stockno,jdbcType=VARCHAR},
      	<if test="remark != null and remark != ''">
      	remark = #{remark,jdbcType=VARCHAR},
    	</if>
      	type = #{type,jdbcType=CHAR},
      	acceptid = #{acceptid,jdbcType=INTEGER},
      	accepttime = #{accepttime,jdbcType=TIMESTAMP},
      	sendid = #{sendid,jdbcType=INTEGER}
      where postion = #{postion,jdbcType=VARCHAR}     
  </update>
  <insert id="insertStock" parameterType="com.calculatedfun.dto.Stock">
      insert into stock
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="postion != null" >
        postion,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="acceptid != null" >
        acceptid,
      </if>
      <if test="accepttime != null" >
        accepttime,
      </if>
      <if test="sendid != null" >
        sendid,
      </if>
      <if test="type != null" >
        type,
      </if>
      <if test="stockno != null" >
        stockno,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="postion != null" >
        #{postion,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="acceptid != null" >
        #{acceptid,jdbcType=INTEGER},
      </if>
      <if test="accepttime != null" >
        #{accepttime,jdbcType=TIMESTAMP},
      </if>
      <if test="sendid != null" >
        #{sendid,jdbcType=INTEGER},
      </if>
      <if test="type != null" >
        #{type,jdbcType=CHAR},
      </if>
      <if test="stockno != null" >
        #{stockno,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="confirmStock" >
      update stock
      set stockno=NULL,
      	remark=NULL,
      	acceptid=NULL,
      	sendid=NULL,
      	type=NULL,
      	accepttime=NULL
      where stockno =#{stockno,jdbcType=VARCHAR}
      and type = #{type,jdbcType=CHAR}
  </update>
  <select id="getpostion" parameterType="java.lang.Integer" resultType="java.lang.String">
      select postion
      from stock
      where stockno =#{stockno,jdbcType=VARCHAR}
      and type = #{type,jdbcType=CHAR}
  </select>
  <delete id="deleStockbyStockno">
      delete from stock 
	  	where stockno =#{stockno,jdbcType=VARCHAR}
	  	and type = #{type,jdbcType=CHAR} 
		and postion='系统库位'
  </delete>
  <select id="getAcceptidRequest" resultType="com.calculatedfun.dto.Request">
      select * 
      from request_main
      where requestcode = #{requestcode,jdbcType=INTEGER}
      and requeststatus != '0'
      and requeststatus != '7'
  </select>
  <select id="getAcceptidRequests" resultType="com.calculatedfun.dto.Request" >
      select * 
      from request_main
      where requestcode in 
      <foreach collection="requestcode" index="index" item="requestcode" open="(" close=")" separator=",">
      #{requestcode,jdbcType=VARCHAR}
      </foreach>
      and requeststatus != '0'
      and requeststatus != '7'
  </select>
  <select id="getpaystatusByreqcode" parameterType="java.lang.String" resultType="java.lang.String">
      select paystatus
      from request_main
      where requestcode = #{requestcode,jdbcType=INTEGER}
  </select>
  <update id="updateRequestOwnid" parameterType="java.lang.String">
      update request_main
      set ownid = #{ownid,jdbcType=VARCHAR}
      where requestcode = #{requestcode,jdbcType=INTEGER}
  </update>
  <update id="updateRequestStates" parameterType="java.lang.String">
      update request_main
      set internalstates = #{afterInteStates,jdbcType=CHAR}
	  where internalstates =#{beforeInteStates,jdbcType=CHAR}
            and requestcode = #{requestcode,jdbcType=INTEGER}
  </update>
  <update id="updateReqstaBypaystatus" parameterType="java.lang.String">
      update request_main
      set requeststatus = #{reqstatus,jdbcType=CHAR}
	  where paystatus =#{paystatus,jdbcType=CHAR}
            and requestcode = #{requestcode,jdbcType=INTEGER}
  </update>
  <select id="getAcceptidPack" resultType="com.calculatedfun.dto.LogisticsPack">
      select * 
      from logistics_pack
      where packno = #{packno,jdbcType=INTEGER}
  </select>
  <update id="updatePackOwnid">
      update logistics_pack
      set ownid = #{ownid,jdbcType=VARCHAR}
      where packno = #{packno,jdbcType=INTEGER}
  </update>
  
<!--   Stock_Out -->

 <select id="selectStockOutList" resultType="com.calculatedfun.dto.StockOut" parameterType="com.calculatedfun.bean.StockOutSel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select * from stock_out
    where status = '0'
    <if test="id != null and id != ''">
      and id =#{id,jdbcType=VARCHAR}
    </if>
    <if test="outby != null and outby != ''">
      and outby =#{outby,jdbcType=INTEGER}
    </if>
    <if test="outtime != null and outtime != ''">
      and outtime =#{outtime,jdbcType=TIMESTAMP}
    </if>
    <if test="goodsid != null and goodsid != ''">
      and goodsid like CONCAT('%','${goodsid}','%' )
    </if>
    <if test="type != null and type != ''">
      and type =#{type,jdbcType=CHAR}
    </if>
    <if test="status != null and status != ''">
      and status =#{status,jdbcType=CHAR}
    </if>
    <if test="sortid != null and sortid != ''">
     order by id
    </if>
    <if test="sortoutby != null and sortoutby != ''">
     order by outby
    </if>
    <if test="sortouttime != null and sortouttime != ''">
     order by outtime
    </if>
    <if test="sortgoodsid != null and sortgoodsid != ''">
     order by goodsid
    </if>
    <if test="sorttype != null and sorttype != ''">
     order by type
    </if>
    <if test="sortstatus != null and sortstatus != ''">
     order by status
    </if>
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
   	 limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}
  </select>
  <select id="getStockOutListCount" parameterType="com.calculatedfun.dto.StockOut" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select count(*) from stock_out
   	where status = '0' 
   	<if test="id != null and id != ''">
      and id =#{id,jdbcType=VARCHAR}
    </if>
    <if test="outby != null and outby != ''">
      and outby =#{outby,jdbcType=INTEGER}
    </if>
    <if test="outtime != null and outtime != ''">
      and outtime =#{outtime,jdbcType=TIMESTAMP}
    </if>
    <if test="goodsid != null and goodsid != ''">
      and goodsid like CONCAT('%','${goodsid}','%' )
    </if>
    <if test="type != null and type != ''">
      and type =#{type,jdbcType=CHAR}
    </if>
    <if test="status != null and status != ''">
      and status =#{status,jdbcType=CHAR}
    </if>
  </select>
  <insert id="insertStockOut" parameterType="com.calculatedfun.dto.StockOut" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 29 17:16:13 CST 2013.
    -->
    insert into stock_out
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="outby != null" >
        outby,
      </if>
      <if test="outtime != null" >
        outtime,
      </if>
      <if test="goodsid != null" >
        goodsid,
      </if>
      <if test="type != null" >
        type,
      </if>
      <if test="status != null" >
        status,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="outby != null" >
        #{outby,jdbcType=INTEGER},
      </if>
      <if test="outtime != null" >
        #{outtime,jdbcType=TIMESTAMP},
      </if>
      <if test="goodsid != null" >
        #{goodsid,jdbcType=INTEGER},
      </if>
      <if test="type != null" >
        #{type,jdbcType=CHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=CHAR},
      </if>
    </trim>
  </insert>
  <select id="getStockOutById" resultType="com.calculatedfun.dto.StockOut">
      select * 
      from stock_out
      where id = #{id,jdbcType=VARCHAR}
      and status='0'
  </select>
  <update id="confirmStockOut" parameterType="com.calculatedfun.dto.StockOut">
      update stock_out
      set status = '1',
      	confirmby = #{confirmby,jdbcType=INTEGER},
      	confirmtime = #{confirmtime,jdbcType=TIMESTAMP}
      where id = #{id,jdbcType=VARCHAR}
  </update>
<!--   Logistics_Transfer -->

  <insert id="insertLogTransfer" parameterType="com.calculatedfun.dto.LogisticsTransfer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu May 30 11:59:48 CST 2013.
    -->
    insert into logistics_transfer
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="transferfrom != null" >
        transferfrom,
      </if>
      <if test="transferto != null" >
        transferto,
      </if>
      <if test="occurrencetime != null" >
        occurrencetime,
      </if>
      <if test="type != null" >
        type,
      </if>
      <if test="goodsid != null" >
        goodsid,
      </if>
      <if test="status != null" >
        status,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="transferfrom != null" >
        #{transferfrom,jdbcType=INTEGER},
      </if>
      <if test="transferto != null" >
        #{transferto,jdbcType=INTEGER},
      </if>
      <if test="occurrencetime != null" >
        #{occurrencetime,jdbcType=TIMESTAMP},
      </if>
      <if test="type != null" >
        #{type,jdbcType=CHAR},
      </if>
      <if test="goodsid != null" >
        #{goodsid,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <select id="getCostbyRequestids" resultType="com.calculatedfun.dto.Request" parameterType="java.lang.String">
      select * from request_main
      where delflag='0'
      <if test="requeststatus != null" >
      	and requeststatus = #{requeststatus,jdbcType=CHAR}
      </if>
      and id in
          <foreach item="item" index="index" collection="requestIdArr"
    		open="(" separator="," close=")">
    		#{item}
  		  </foreach>
  	  order by requestcode 
  </select>
  <select id="getPayReceiveList" resultType="com.calculatedfun.dto.PayRequestReceive" parameterType="java.lang.String">
      select * from pay_request_receive
      where status='0'
      and requestid in
      	  <foreach item="item" index="index" collection="requestIdArr"
    		open="(" separator="," close=")">
    		#{item}
  		  </foreach>
  	  ORDER BY requestid,type DESC
  </select>
  <update id="financialReceiveStatus" parameterType="java.lang.String">
      update pay_request_receive
      set status='1'
      where status='0'
      and requestid in
          <foreach item="item" index="index" collection="requestIdArr"
    		open="(" separator="," close=")">
    		#{item}
  		  </foreach>
  </update>
  <update id="updateRequestStatus" parameterType="java.lang.String">
      update request_main 
      set requeststatus =#{afterStatus,jdbcType=CHAR}
      where requeststatus =#{beforeStatus,jdbcType=CHAR}
      and requestcode = #{requestcode,jdbcType=INTEGER}
      and delflag='0'
      and paystatus ='1'
  </update>
  <select id="getStockbystockno" resultType="com.calculatedfun.dto.Stock">
      select *
      from stock
      where stockno =#{stockno,jdbcType=VARCHAR}
  </select>
<!--   RequestLogistics -->
  <select id="getRequestLogistics" resultType="com.calculatedfun.dto.RequestLogistics">
      select * from request_logistics
      where requestcode =#{requestcode,jdbcType=VARCHAR}
  </select>
  <insert id="insertRequestlogistic" parameterType="com.calculatedfun.dto.RequestLogistics" >
    insert into request_logistics
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="requestcode != null" >
        requestcode,
      </if>
      <if test="logisticsno != null" >
        logisticsno,
      </if>
      <if test="packlength != null" >
        packlength,
      </if>
      <if test="company != null" >
        company,
      </if>
      <if test="createtime != null" >
        createtime,
      </if>
      <if test="packwidth != null" >
        packwidth,
      </if>
      <if test="packheight != null" >
        packheight,
      </if>
      <if test="createby != null" >
        createby,
      </if>
      <if test="remark != null" >
        remark,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="requestcode != null" >
        #{requestcode,jdbcType=VARCHAR},
      </if>
      <if test="logisticsno != null" >
        #{logisticsno,jdbcType=VARCHAR},
      </if>
      <if test="packlength != null" >
        #{packlength,jdbcType=INTEGER},
      </if>
      <if test="company != null" >
        #{company,jdbcType=VARCHAR},
      </if>
      <if test="createtime != null" >
        #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="packwidth != null" >
        #{packwidth,jdbcType=INTEGER},
      </if>
      <if test="packheight != null" >
        #{packheight,jdbcType=INTEGER},
      </if>
      <if test="createby != null" >
        #{createby,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <insert id="insertRequestlogistics" parameterType="java.util.List" >
    insert into request_logistics (id,company,requestcode,createtime,createby)
    values
    <foreach collection="list" item="item" index="index" separator=",">
    	(
    	#{item.id,jdbcType=VARCHAR},
    	#{item.company,jdbcType=VARCHAR},
    	#{item.requestcode,jdbcType=VARCHAR},
    	#{item.createtime,jdbcType=TIMESTAMP},
    	#{item.createby,jdbcType=VARCHAR}
    	)
    </foreach>
  </insert>
  <update id="updateRequestlogistic" parameterType="com.calculatedfun.dto.RequestLogistics">
       update request_logistics
    <set >
      <if test="requestcode != null" >
        requestcode = #{requestcode,jdbcType=VARCHAR},
      </if>
      <if test="logisticsno != null" >
        logisticsno = #{logisticsno,jdbcType=VARCHAR},
      </if>
        packlength = #{packlength,jdbcType=INTEGER},
      <if test="company != null" >
        company = #{company,jdbcType=VARCHAR},
      </if>
      <if test="createtime != null" >
        createtime = #{createtime,jdbcType=TIMESTAMP},
      </if>
   		packwidth = #{packwidth,jdbcType=INTEGER},
        packheight = #{packheight,jdbcType=INTEGER},
      <if test="createby != null" >
        createby = #{createby,jdbcType=INTEGER},
      </if>
        remark = #{remark,jdbcType=VARCHAR},
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <resultMap id="userResultMap" type="com.calculatedfun.dto.Users" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Apr 27 15:24:36 CST 2013.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="usercode" property="usercode" jdbcType="INTEGER" />
    <result column="registerdate" property="registerdate" jdbcType="TIMESTAMP" />
    <result column="title" property="title" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="birthday" property="birthday" jdbcType="VARCHAR" />
    <result column="documenttype" property="documenttype" jdbcType="CHAR" />
    <result column="documentcode" property="documentcode" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="rate" property="rate" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="delflag" property="delflag" jdbcType="CHAR" />
    <result column="defaultmail" property="defaultmail" jdbcType="VARCHAR" />
    <result column="defaulttel" property="defaulttel" jdbcType="VARCHAR" />
    <result column="defaultmobile" property="defaultmobile" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="user_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Apr 27 15:24:36 CST 2013.
    -->
    id, usercode, registerdate, title, remark, birthday, documenttype, documentcode, 
    password, rate, name, delflag, defaultmail, defaulttel, defaultmobile
  </sql>
  <select id="gerUser" resultMap="userResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Apr 27 15:24:36 CST 2013.
    -->
    select 
    <include refid="user_Column_List" />
    from user
    where id = #{userid,jdbcType=VARCHAR}
  </select>
  <delete id="delOthersStockOut" parameterType="java.lang.String" >
      DELETE FROM stock_out 
      WHERE goodsid = #{goodsid,jdbcType=INTEGER}
      AND type = #{type,jdbcType=CHAR} 
      AND status = #{status,jdbcType=CHAR}
  </delete>
  <select id="getPostInfoByReqCode" resultType="com.calculatedfun.bean.PostInfo" parameterType="java.lang.String" >
      SELECT r.requestcode,r.receiver,r.mobile AS receivermobile,r.customer,r.usercode,r.zip,r.totalevaluate,e.`name`,
		CONCAT(ExtractValue(c.fullname, "//value[@lang='zh_CN']"),ExtractValue(p.name, "//value[@lang='zh_CN']"),
		ExtractValue(ct.fullname, "//value[@lang='zh_CN']"),ExtractValue(d.fullname, "//value[@lang='zh_CN']"),r.address) AS address,
		ExtractValue(ct.fullname, "//value[@lang='zh_CN']") as city,
		ct.code as areaCode,
		r.sendtype,r.totalinsurance
		FROM request_main r , employee e ,sys_country c ,sys_province p ,sys_city ct , sys_district d
		
		WHERE r.requestcode = #{requestcode,jdbcType=INTEGER} 
		AND e.id = #{employeeid,jdbcType=INTEGER}
		AND r.country = c.id
		AND r.province = p.id
		AND r.city = ct.id
		AND r.area = d.id
  </select>
  <select id="getReqCurStatus" resultType="java.lang.String" parameterType="java.lang.String" >
      SELECT internalstates FROM request_main 
      WHERE requestcode = #{requestcode,jdbcType=INTEGER}
  </select>
  <resultMap id="EmployeeRoleResultMap" type="com.calculatedfun.dto.EmployeeRole" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="rolename" property="rolename" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="EmployeeRole_Column_List" >
    id, rolename
  </sql>
  <select id="getEmployeeRole" resultMap="EmployeeRoleResultMap">
    select 
    <include refid="EmployeeRole_Column_List" />
    from ${@com.kaifantech.init.sys.dao.AppTables@EMPLOYEE_ROLE}
  </select>
  <insert id="insert" parameterType="com.calculatedfun.dto.Employee" >
    insert into employee
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="userid != null" >
        userid,
      </if>
      <if test="role != null" >
        role,
      </if>
      <if test="name != null" >
        name,
      </if>
      <if test="password != null" >
        password,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="userid != null" >
        #{userid,jdbcType=INTEGER},
      </if>
      <if test="role != null" >
        #{role,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        #{password,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <resultMap id="EmployeeResultMap" type="com.calculatedfun.dto.Employee" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <id column="userid" property="userid" jdbcType="INTEGER" />
    <result column="role" property="role" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Employee_Column_List" >
    id, userid, role, name, password,delflag
  </sql>
  <select id="selectAllEmployee" resultMap="EmployeeResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Employee_Column_List" />
    from employee LIMIT #{page,jdbcType=INTEGER},#{pagesize,jdbcType=INTEGER}
  </select>
  <select id="countEmployee" resultType="java.lang.Integer">
    select count(*) from employee
  </select>
  <select id="SearchDelflag" resultType="java.lang.Integer">
  	select delflag from employee where id = #{id,jdbcType=INTEGER}
  </select>
  <update id="UpdateDelflag" parameterType="com.calculatedfun.dto.Employee">
  	update employee set delflag=#{delflag,jdbcType=VARCHAR} where id = #{id,jdbcType=VARCHAR}
  </update>
  <select id="selectAllEmployeeRole" resultType="com.calculatedfun.dto.EmployeeRole" >
    select *
    from ${@com.kaifantech.init.sys.dao.AppTables@EMPLOYEE_ROLE} where delflag=0
  </select>
</mapper>