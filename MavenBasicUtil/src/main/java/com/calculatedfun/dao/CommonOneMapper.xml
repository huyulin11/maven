<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.calculatedfun.dao.CommonOneMapper" >
    <select id="selectUserById" resultType="com.calculatedfun.dto.Users" parameterType="java.lang.String" >
    select * 
    from user
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <!-- UserMobile======================================================start -->
  
  <insert id="insertMobile" parameterType="com.calculatedfun.dto.UserMobile" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 25 21:58:32 CST 2013.
    -->
    insert into user_mobile (id, userid, telephone, 
      isdefault, status, delflag, 
      remark
     <if test="isremove != null and isremove != ''">
         ,isremove
     </if>
     )
    values (#{id,jdbcType=VARCHAR}, #{userid,jdbcType=VARCHAR}, #{telephone,jdbcType=VARCHAR}, 
      #{isdefault,jdbcType=CHAR}, #{status,jdbcType=CHAR}, #{delflag,jdbcType=CHAR}, 
      #{remark,jdbcType=VARCHAR}
       <if test="isremove != null and isremove != ''">
           ,#{isremove,jdbcType=VARCHAR}
       </if>
       )
  </insert>
  <select id="selectUserMobileList" resultType="com.calculatedfun.dto.UserMobile" parameterType="com.calculatedfun.bean.UserMobileSel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select * from user_mobile
    where 1=1
    and delflag = '0' 
    <if test="userid != null and userid != ''">
      and userid =#{userid,jdbcType=VARCHAR}
    </if>
    <if test="telephone != null and telephone != ''">
      and telephone =#{telephone,jdbcType=VARCHAR}
    </if>
    <if test="isdefault != null and isdefault != ''">
      and isdefault =#{isdefault,jdbcType=CHAR}
    </if>
    <if test="status != null and status != ''">
      and status =#{status,jdbcType=CHAR}
    </if>
    <if test="sortid != null and sortid != ''">
     order by id
    </if>
    <if test="sortuserid != null and sortuserid != ''">
     order by userid
    </if>
    <if test="sorttelephone != null and sorttelephone != ''">
     order by telephone
    </if>
    <if test="sortisdefault != null and sortisdefault != ''">
     order by isdefault
    </if>
    <if test="sortstatus != null and sortstatus != ''">
     order by status
    </if>
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
   	<!-- limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}-->
  </select>
  <select id="userMobileCount" parameterType="com.calculatedfun.dto.UserMobile" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select count(*) from user_mobile
   	where 1=1 
   	and delflag = '0'
   	<if test="userid != null and userid != ''">
   	    and userid = #{userid}
   	</if>
    <if test="telephone != null and telephone != ''">
   	    and telephone = #{telephone,jdbcType=VARCHAR}
   	</if>
   	<if test="isdefault != null and isdefault != ''">
   	    and isdefault = #{isdefault,jdbcType=CHAR}
   	</if>
   	<if test="status != null and status != ''">
   	    and status = #{status,jdbcType=CHAR}
   	</if>
  </select>
  <update id="delSelectedMobile" parameterType="java.lang.String" >
    update user_mobile 
    set delflag = '1'
    where id in 
  <foreach item="item" index="index" collection="scope"
    open="(" separator="," close=")">
    #{item}
  </foreach>
  </update>
  <update id="updateMobileApprove" parameterType="java.lang.String" >
    update user_mobile set status = '1' where userid = #{userid,jdbcType=VARCHAR} and telephone=#{no,jdbcType=VARCHAR}
  </update>
  
    <update id="updataMobibleStatus" parameterType="java.lang.String" >
    update user_mobile set status =#{status,jdbcType=CHAR}  where id = #{id,jdbcType=VARCHAR}
  </update>
  
  <update id="mUpdateCurDefaultAndUserTab" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    UPDATE user_mobile m 
    INNER JOIN user u 
    ON m.userid = u.id 
    SET m.isdefault = '1',
    u.defaultmobile = m.telephone 
    WHERE m.id = #{userMobileId,jdbcType=VARCHAR}
    and m.userid=#{userid,jdbcType=VARCHAR}
  </update>
  <update id="mUpdateOldDefault" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    UPDATE user_mobile 
    SET isdefault = '0' 
    WHERE isdefault = '1' 
    AND id != #{userMobileId,jdbcType=VARCHAR}
    and userid=#{userid,jdbcType=VARCHAR}
  </update>
  <update id="mUpdateOldDefaultAndUserTab" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    UPDATE user_mobile m 
    SET m.isdefault = '0'
    WHERE m.isdefault = '1' 
    and m.id != #{userMobileId,jdbcType=VARCHAR}
    and m.userid=#{userid,jdbcType=VARCHAR}
  </update>
  <select id="validDefaultMobileCount" resultType="java.lang.Integer" >
    SELECT COUNT(*) FROM user_mobile 
    WHERE isdefault = '1' AND delflag = '0'
    and userid = #{userid,jdbcType=VARCHAR} 
  </select>
  <update id="removeDefaultMobile" parameterType="java.lang.String">
    UPDATE user 
    SET defaultmobile = '' 
    WHERE id = #{userid,jdbcType=VARCHAR}
  </update>
  
  <!-- UserMobile========================================================end -->
  
  <!-- UserTel=========================================================start -->
  
  <insert id="insertTel" parameterType="com.calculatedfun.dto.UserTel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 26 16:29:44 CST 2013.
    -->
    insert into user_tel (id, userid, telephone, 
      isdefault, delflag, remark
      )
    values (#{id,jdbcType=VARCHAR}, #{userid,jdbcType=VARCHAR}, #{telephone,jdbcType=VARCHAR}, 
      #{isdefault,jdbcType=CHAR}, #{delflag,jdbcType=CHAR}, #{remark,jdbcType=VARCHAR}
      )
  </insert>
  <select id="selectUserTelList" resultType="com.calculatedfun.dto.UserTel" parameterType="com.calculatedfun.bean.UserTelSel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select * from user_tel
    where 1=1
    and delflag = '0' 
    <if test="userid != null and userid != ''">
      and userid =#{userid,jdbcType=VARCHAR}
    </if>
    <if test="telephone != null and telephone != ''">
      and telephone =#{telephone,jdbcType=VARCHAR}
    </if>
    <if test="isdefault != null and isdefault != ''">
      and isdefault =#{isdefault,jdbcType=CHAR}
    </if>
    <if test="delflag != null and delflag != ''">
      and delflag =#{delflag,jdbcType=CHAR}
    </if>
    <if test="sortid != null and sortid != ''">
     order by id
    </if>
    <if test="sortuserid != null and sortuserid != ''">
     order by userid
    </if>
    <if test="sorttelephone != null and sorttelephone != ''">
     order by telephone
    </if>
    <if test="sortisdefault != null and sortisdefault != ''">
     order by isdefault
    </if>
    <if test="sortdelflag != null and sortdelflag != ''">
     order by delflag
    </if>
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
   	<!-- limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}-->
  </select>
  <select id="userTelCount" parameterType="com.calculatedfun.dto.UserTel" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select count(*) from user_tel 
   	where 1=1 and delflag = '0'
   	<if test="userid != null and userid != ''">
   	    and userid = #{userid}
   	</if>
    <if test="telephone != null and telephone != ''">
   	    and telephone = #{telephone,jdbcType=VARCHAR}
   	</if>
   	<if test="isdefault != null and isdefault != ''">
   	    and isdefault = #{isdefault,jdbcType=CHAR}
   	</if>
  </select>
  <update id="delSelectedTel" parameterType="java.lang.String" >
    update user_tel  
    set delflag = '1'
    where id in 
  <foreach item="item" index="index" collection="scope"
    open="(" separator="," close=")">
    #{item}
  </foreach>
  </update>
  <select id="validDefaultTelCount" resultType="java.lang.Integer" >
    SELECT COUNT(*) FROM user_tel  
    WHERE isdefault = '1' AND delflag = '0' 
    and userid= #{userid,jdbcType=VARCHAR}
  </select>
  <update id="removeDefaultTel" parameterType="java.lang.String">
    UPDATE user 
    SET defaulttel = '' 
    WHERE id = #{userid,jdbcType=VARCHAR}
  </update>
  <update id="tUpdateCurDefaultAndUserTab" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    UPDATE user_tel t 
    INNER JOIN user u 
    ON t.userid = u.id 
    SET t.isdefault = '1',
    u.defaulttel = t.telephone 
    WHERE t.id = #{userTelId,jdbcType=VARCHAR}
    and t.userid =#{userid,jdbcType=VARCHAR}
  </update>
  <update id="tUpdateOldDefault" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    UPDATE user_tel 
    SET isdefault = '0' 
    WHERE isdefault = '1' 
    AND id != #{userTelId,jdbcType=VARCHAR}
    and userid =#{userid,jdbcType=VARCHAR}
  </update>
  <update id="tUpdateOldDefaultAndUserTab" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    UPDATE user_tel t 
    SET t.isdefault = '0'
    WHERE t.isdefault = '1' 
    and t.id != #{userTelId,jdbcType=VARCHAR}
    and t.userid =#{userid,jdbcType=VARCHAR}
  </update>
  <!-- UserTel===========================================================end -->
  <update id="updatePersonInfo" parameterType="java.lang.String">
    UPDATE user 
    SET name = #{name,jdbcType=VARCHAR} ,
    gender = #{gender,jdbcType=CHAR} ,
    birthday = #{birthday,jdbcType=VARCHAR} ,
    documenttype = #{documenttype,jdbcType=CHAR} ,
    documentcode = #{documentcode,jdbcType=VARCHAR} ,
    title = #{title,jdbcType=VARCHAR} ,
    remark = #{remark,jdbcType=VARCHAR} 
    WHERE id = #{id,jdbcType=VARCHAR}
  </update>
  <select id="getRequestCoinList" resultType="com.calculatedfun.bean.RequestCoinBean">
      SELECT * FROM request_coin 
      WHERE INSTR (tagindex,#{keyWord,jdbcType=VARCHAR})
      limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
    <select id="getOneRequestCoin" resultType="com.calculatedfun.bean.RequestCoinBean">
      SELECT rc.* FROM request_coin rc 
	      INNER JOIN request_main r 
	      ON rc.requestid = r.id
	      WHERE 1=1
	      AND (
		    (
		      rc.score != - 1 
		      AND r.`entitytype` != 6
		    ) 
		    OR (
		      (
		        rc.score != - 1 
		        OR (
		          rc.score IS NULL 
		          AND rc.scores IS NOT NULL
		        )
		      ) 
		      AND r.`entitytype` = 6
		    )
		  ) 
	      AND rc.coincode=#{coincode,jdbcType=VARCHAR}
	 	  AND (
				r.requeststatus = '7'
				OR (
					EXISTS (
						SELECT
							1
						FROM
							`user`
						WHERE
							ismonthlyuser = 0
						AND id = r.userid
					)
					AND (
						r.internalstates = 12
						OR (
							r.internalstates = 14
							AND EXISTS (
								SELECT
									1
								FROM
									(
										SELECT
											a.id,
											min(a.rowno) minrowno
										FROM
											(
												SELECT
													r.*,@rowno :=@rowno + 1 rowno
												FROM
													request_in_and_out_bound r,
													(SELECT @rowno := 0) t
											) a
										GROUP BY
											a.id
									) b,
									(
										SELECT
											r.*,@rowno2 :=@rowno2 + 1 rowno
										FROM
											request_in_and_out_bound r,
											(SELECT @rowno2 := 0) t
									) c
								WHERE
									b.id = c.id
								AND b.id = r.id
								AND c.boundtype = '0'
								AND b.minrowno = c.rowno
								AND c.boundstatus = 900
							)
						)
					)
				)
			)
	 	  limit 0 , 1
  </select>
  <select id="getRequestCoinCount" resultType="java.lang.Integer" parameterType="java.lang.String">
      SELECT COUNT(*) FROM request_coin 
      WHERE INSTR (tagindex,#{keyWord,jdbcType=VARCHAR})
  </select>
  <select id="CoinList" resultType="com.calculatedfun.bean.RequestCoinBean" parameterType="java.lang.String">
      SELECT rc.* FROM request_coin rc 
      INNER JOIN request_main r 
      ON rc.requestid = r.id
      WHERE 1=1
      AND (
	    (
	      rc.score != - 1 
	      AND r.`entitytype` != 6
	    ) 
	    OR (
	      (
	        rc.score != - 1 
	        OR (
	          rc.score IS NULL 
	          AND rc.scores IS NOT NULL
	        )
	      ) 
	      AND r.`entitytype` = 6
	    )
	  ) 
      <foreach item="item" index="index" collection="keyWordArr">
    	AND rc.coincode=#{item,jdbcType=VARCHAR}
 	  </foreach>
 	  AND (
			r.requeststatus = '7'
			OR (
				EXISTS (
					SELECT
						1
					FROM
						`user`
					WHERE
						ismonthlyuser = 0
					AND id = r.userid
				)
				AND (
					r.internalstates = 12
					OR (
						r.internalstates = 14
						AND EXISTS (
							SELECT
								1
							FROM
								(
									SELECT
										a.id,
										min(a.rowno) minrowno
									FROM
										(
											SELECT
												r.*,@rowno :=@rowno + 1 rowno
											FROM
												request_in_and_out_bound r,
												(SELECT @rowno := 0) t
										) a
									GROUP BY
										a.id
								) b,
								(
									SELECT
										r.*,@rowno2 :=@rowno2 + 1 rowno
									FROM
										request_in_and_out_bound r,
										(SELECT @rowno2 := 0) t
								) c
							WHERE
								b.id = c.id
							AND b.id = r.id
							AND c.boundtype = '0'
							AND b.minrowno = c.rowno
							AND c.boundstatus = 900
						)
					)
				)
			)
		)
 	  limit 0 , 1
  </select>
  <select id="CoinCount" resultType="java.lang.Integer" parameterType="java.lang.String">
      select count(*) from(
      SELECT rc.* FROM request_coin rc 
      INNER JOIN request_main r 
      ON rc.requestid = r.id
      WHERE 1=1
      AND rc.score !=0 
      AND rc.score !=-1
      <foreach item="item" index="index" collection="keyWordArr">
    	AND rc.coincode=#{item,jdbcType=VARCHAR}
 	  </foreach>
 	  AND (
			r.requeststatus = '7'
			OR (
				EXISTS (
					SELECT
						1
					FROM
						`user`
					WHERE
						ismonthlyuser = 0
					AND id = r.userid
				)
				AND r.internalstates = 12
			)
		)
 	  ) t
  </select>
  <select id="getIdByMobile" resultType="java.lang.String" parameterType="java.lang.String">
      SELECT userid FROM user_mobile 
      WHERE telephone = #{mobile,jdbcType=VARCHAR}
  </select>
  <select id="searchUserByKeyWord" resultType="com.calculatedfun.dto.Users">
      SELECT * FROM user 
      WHERE 1=1
      <if test="s_Mobile != null and s_Mobile !=''">
          AND id IN (SELECT userid FROM user_mobile umb WHERE umb.telephone=#{s_Mobile,jdbcType=VARCHAR}) 
      </if>
      <if test="s_Mail !=null and s_Mail != ''">
          AND id IN (SELECT userid FROM user_mail um WHERE um.mail=#{s_Mail,jdbcType=VARCHAR})
      </if>
      <if test="s_UserCode !=null and s_UserCode != -1">
          AND usercode = #{s_UserCode,jdbcType=INTEGER}
      </if>
      <if test="s_Name != null and s_Name != ''">
          AND INSTR(name,#{s_Name,jdbcType=VARCHAR})
      </if>
      order by registerdate desc 
      limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER} 
      
  </select>
  <select id="searchUserOp" resultType="com.calculatedfun.dto.Users">
  	 select * from user 
  	 where 1=1
  	 <if test="s_Mobile != null and s_Mobile !=''">
          AND id IN (SELECT userid FROM user_mobile umb WHERE umb.telephone=#{s_Mobile,jdbcType=VARCHAR}) 
      </if>
      <if test="s_Mail !=null and s_Mail != ''">
          AND id IN (SELECT userid FROM user_mail um WHERE um.mail=#{s_Mail,jdbcType=VARCHAR})
      </if>
      <if test="s_UserCode !=null and s_UserCode != -1">
          AND usercode = #{s_UserCode,jdbcType=INTEGER}
      </if>
      <if test="s_Name != null and s_Name != ''">
          AND INSTR(name,#{s_Name,jdbcType=VARCHAR})
      </if>
      order by registerdate desc 
  </select>
  <select id="userCountByKeyWord" resultType="java.lang.Integer">
       SELECT COUNT(*) FROM user 
      WHERE 1=1
      <if test="s_Mobile != null and s_Mobile !=''">
          AND id IN (SELECT userid FROM user_mobile WHERE INSTR(telephone,#{s_Mobile,jdbcType=VARCHAR})) 
      </if>
      <if test="s_Mail !=null and s_Mail != ''">
          AND id IN (SELECT userid FROM user_mail WHERE mail = #{s_Mail,jdbcType=VARCHAR})
      </if>
      <if test="s_UserCode !=null and s_UserCode != -1">
          AND usercode = #{s_UserCode,jdbcType=INTEGER}
      </if>
      <if test="s_Name != null and s_Name != ''">
          AND INSTR(name,#{s_Name,jdbcType=VARCHAR})
      </if>
  </select>    
  <insert id="insertSearchRecord" parameterType="com.calculatedfun.dto.Searchrecord" >
    insert into searchrecord (id, userid, keyword, 
      ip, time)
    values (#{id,jdbcType=VARCHAR}, #{userid,jdbcType=VARCHAR}, #{keyword,jdbcType=VARCHAR}, 
      #{ip,jdbcType=VARCHAR}, #{time,jdbcType=TIMESTAMP})
  </insert>
  
  <select id="getRequestListByPackCode" resultType="com.calculatedfun.dto.Request" parameterType="java.lang.String">
      SELECT id,requestcode,userid,usercode 
      FROM request_main 
      WHERE packagecode = #{packcode,jdbcType=VARCHAR}
      AND requeststatus = '1'
  </select>
  <select id="getUserByApprovedTel" resultType="com.calculatedfun.dto.Users" parameterType="java.lang.String">
      SELECT id,usercode,name FROM user 
      WHERE id = 
	  (
	  	SELECT userid FROM user_login 
	  	WHERE loginname = #{tel,jdbcType=VARCHAR} 
	  )
  </select>
  <select id="getCustomerNameByCode" resultType="java.lang.String" parameterType="java.lang.Integer">
      SELECT name FROM user 
      WHERE usercode = #{customercode,jdbcType=INTEGER}
  </select>
  <insert id="insertPackageInfo" parameterType="com.calculatedfun.dto.LogisticsPack">
    
    insert into logistics_pack (id, logisticsno, shippername, 
      shippertel, shipperaddress, packstatus, 
      receivestatus, requestcodes, 
      type, customertel, customername, 
      remark, customerno, ownid, 
      createtime, createby, cuttime, 
      cutstatus,logisticsname)
    values (#{id,jdbcType=VARCHAR}, #{logisticsno,jdbcType=VARCHAR}, #{shippername,jdbcType=VARCHAR}, 
      #{shippertel,jdbcType=VARCHAR}, #{shipperaddress,jdbcType=VARCHAR}, #{packstatus,jdbcType=CHAR}, 
      #{receivestatus,jdbcType=CHAR}, #{requestcodes,jdbcType=VARCHAR},  
      #{type,jdbcType=CHAR}, #{customertel,jdbcType=VARCHAR}, #{customername,jdbcType=VARCHAR}, 
      #{remark,jdbcType=VARCHAR}, #{customerno,jdbcType=INTEGER}, #{ownid,jdbcType=VARCHAR}, 
      #{createtime,jdbcType=TIMESTAMP}, #{createby,jdbcType=INTEGER}, #{cuttime,jdbcType=TIMESTAMP}, 
      #{cutstatus,jdbcType=CHAR},#{logisticsname,jdbcType=VARCHAR})
  </insert>
  <select id="getPackNoById" resultType="java.lang.Integer" parameterType="java.lang.String">
       SELECT packno FROM logistics_pack 
       WHERE id = #{id}
  </select>
  <select id="getPackByNo" resultType="com.calculatedfun.bean.TransferGoods" parameterType="java.lang.Integer">
      SELECT t.goodstype,
      t.goodsno,
      t.ownid,
      '-1' as requeststatus,
      t.goodsstatus,
      e.name as ownname,
      t.sendtype,
      t.handlingtime 
      FROM 	
		(
		SELECT '包裹' as goodstype,
						packno as goodsno,
						ownid as ownid,
						cutstatus as goodsstatus,
						'' as sendtype,
						createtime as handlingtime 
						FROM logistics_pack 
						WHERE packno = #{packno,jdbcType=INTEGER}
						AND cutstatus = '0' 
						AND receivestatus = '0'
		)t LEFT JOIN employee e ON t.ownid = e.id 
  </select>
  <select id="getRequestByNo" resultType="com.calculatedfun.bean.TransferGoods" parameterType="java.lang.Integer">
       SELECT t.goodstype,
      t.goodsno,
      t.coinnum,
      t.ownid,
      t.goodsstatus,
      t.requeststatus,
      e.name as ownname,
      t.sendtype,
      t.handlingtime 
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	requestcode as goodsno,
	  	totalamount AS coinnum,
	  	ownid as ownid,
	  	requeststatus as requeststatus,
	  	internalstates as goodsstatus,
	  	sendtype as sendtype,
		requesttime as handlingtime 
	  	FROM request_main 
	  	WHERE requestcode = #{requestcode,jdbcType=INTEGER}
	  	AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
  </select>
  <update id="changePackOwner">
    UPDATE logistics_pack 
    SET ownid = #{ownid,jdbcType=VARCHAR}  
    WHERE packno = #{packno,jdbcType=INTEGER}
  </update>
  <update id="changeRequestOwner">
    UPDATE request_main 
    SET ownid = #{ownid,jdbcType=VARCHAR}  
    WHERE requestcode = #{requestcode,jdbcType=INTEGER}
  </update>
  <select id="getSearchEntityType" resultType="java.lang.String">
  	SELECT entitytype FROM request_main WHERE requestcode=#{requestCode,jdbcType=VARCHAR}
  </select>
  <select id="getSearchCoinNum" resultType="java.lang.String">
  	SELECT totalamount FROM request_main WHERE requestcode=#{requestCode,jdbcType=VARCHAR}
  </select>
  <select id="getCoinNum" resultType="java.lang.String">
  		SELECT 		  SUM(t.coinnum)as coinnum
		FROM
		  (
		    (SELECT 
		      '包裹' AS goodstype,
		      packno AS goodsno,
		      ownid AS ownid,
		      '-1' AS requeststatus,
		      cutstatus AS goodsstatus,
		      '' AS sendtype,
		      createtime AS handlingtime,
		      '' paydiffertime,
		      '' payinfo,
		      '' coinnum 
		    FROM
		      logistics_pack 
		    WHERE cutstatus = '0' 
		      AND receivestatus = '0') 
		    UNION
		    ALL 
		    (SELECT 
		      '申请单' AS goodstype,
		      rr.requestcode AS goodsno,
		      rr.ownid AS ownid,
		      rr.requeststatus AS requeststatus,
		      rr.internalstates AS goodsstatus,
		      rr.sendtype AS sendtype,
		      rr.requesttime AS handlingtime,
		      TIME_TO_SEC(
		        TIMEDIFF(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          rr.duetime
		        )
		      ) * (- 1) AS paydiffertime,
		      (
			      CASE
			        WHEN rr.paystatus = '1' 
			        THEN IFNULL(
			          (SELECT 
			            DATE_FORMAT(
			              MAX(p.createdate),
			              '%Y-%m-%d %H:%i:%S'
			            ) 
			          FROM
			            pay_journal p 
			          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
			          "已支付"
			        ) 
			        ELSE "--" 
			      END
			    ) payinfo,
		      (SELECT SUM(r.amount) FROM request_detail r WHERE requestid=rr.id) coinnum 
		    FROM
		      request_main rr 
		    WHERE rr.internalstates = '1' 
		      OR rr.internalstates = '2' 
		      OR rr.internalstates = '3' 
		      AND rr.delflag = '0')
		  ) t 
		  LEFT JOIN employee e 
		    ON t.ownid = e.id
		  LEFT JOIN request_main r ON r.requestcode=goodsno
		  where 1=1 
		  <if test="entityType!=0 and entityType!=-1 and entityType!=-2">
		  and r.entitytype=#{entityType,jdbcType=VARCHAR}
		  </if>
		  <if test="entityType==0">
		 	and r.entitytype is null
		  </if>
		  <if test="entityType==-1">
		   and r.entitytype is not null
		  </if>  
  </select>
   <select id="getCoinServiceNum" resultType="java.lang.String">
   		SELECT 
		  SUM(t.coinnum)
		FROM
		  (
		    (SELECT 
		      '包裹' AS goodstype,
		      packno AS goodsno,
		      ownid AS ownid,
		      '-1' AS requeststatus,
		      cutstatus AS goodsstatus,
		      '' AS sendtype,
		      createtime AS handlingtime,
		      '' paydiffertime,
		      '' payinfo,
		      '' coinnum 
		    FROM
		      logistics_pack 
		    WHERE cutstatus = '0' 
		      AND receivestatus = '0' 
		      AND ownid = '--') 
		    UNION
		    ALL 
		    (SELECT 
		      '申请单' AS goodstype,
		      rr.requestcode AS goodsno,
		      rr.ownid AS ownid,
		      rr.requeststatus AS requeststatus,
		      rr.internalstates AS goodsstatus,
		      rr.sendtype AS sendtype,
		      rr.requesttime AS handlingtime,
		      TIME_TO_SEC(
		        TIMEDIFF(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          rr.duetime
		        )
		      ) * (- 1) AS paydiffertime,
		      (
			      CASE
			        WHEN rr.paystatus = '1' 
			        THEN IFNULL(
			          (SELECT 
			            DATE_FORMAT(
			              MAX(p.createdate),
			              '%Y-%m-%d %H:%i:%S'
			            ) 
			          FROM
			            pay_journal p 
			          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
			          "已支付"
			        ) 
			        ELSE "--" 
			      END
			    ) payinfo,
		      (SELECT SUM(r.amount) FROM request_detail r WHERE requestid=rr.id) coinnum 
		    FROM
		      request_main rr 
		    WHERE rr.requeststatus = '6' 
		      AND rr.delflag = '0' 
		      AND rr.sendtype = '2'
		      <if test="entityType!=-1 and entityType!=0 and entityType!=-2">
		      AND rr.entitytype = #{entityType,jdbcType=VARCHAR}
		      </if>
		      <if test="entityType==0">
		 		and rr.entitytype is null
		  	  </if>
		  	  <if test="entityType==-1">
		   		and rr.entitytype is not null
		      </if>  )
		  ) t 
		  LEFT JOIN employee e 
		    ON t.ownid = e.id 
   </select>
   <select id="getCoinCommonNum" resultType="java.lang.String">
   	SELECT 
		  SUM(t.coinnum)
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request_main rr 
		  WHERE rr.internalstates = #{status1,jdbcType=CHAR}
		  	 OR rr.internalstates = #{status2,jdbcType=CHAR} 
	  		AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  WHERE 1=1 
	  <if test="entityType!=-1 and entityType!=0 and entityType!=-2">
	   and r.entitytype=#{entityType,jdbcType=VARCHAR}
	  </if>
	  <if test="entityType==0">
	   and r.entitytype is null
	  </if>
	  <if test="entityType==-1">
	   and r.entitytype is not null
	  </if>
   </select>
   <select id="getCoinRareNum" resultType="java.lang.String">
   	SELECT 
		  SUM(t.coinnum)
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request_main rr 
		  WHERE rr.internalstates = #{status1,jdbcType=CHAR}
		  	 OR rr.internalstates = #{status2,jdbcType=CHAR} 
		  	 OR rr.internalstates = #{status3,jdbcType=CHAR} 
	  		AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  WHERE 1=1 
	  <if test="entityType!=-1 and entityType!=0 and entityType!=-2">
	   and r.entitytype=#{entityType,jdbcType=VARCHAR}
	  </if>
	  <if test="entityType==0">
	   and r.entitytype is null
	  </if>
	  <if test="entityType==-1">
	   and r.entitytype is not null
	  </if>
   </select>
   <select id="CoinInternalstatesNum" resultType="java.lang.String">
   	SELECT 
		  SUM(t.coinnum)
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request_main rr 
		  WHERE delflag = '0' 
		  	 <if test="internalstates>0 ">
		  	 	AND rr.internalstates = #{internalstates,jdbcType=CHAR}
		  	 </if>
		  	 <if test="internalstates==-1">
		  	 	AND rr.internalstates = 3 
		  	 	OR rr.internalstates = 4
		  	 </if>
		  	 <if test="internalstates==-2">
		  	 	AND rr.internalstates = 5 
		  	 	OR rr.internalstates = 6
		  	 </if>
		  	 <if test="internalstates==-3">
		  	 	AND rr.internalstates = 7 
		  	 	OR rr.internalstates = 8
		  	 </if>
		  	 <if test="internalstates==-4">
		  	 	AND rr.internalstates = 9 
		  	 	OR rr.internalstates = 10
		  	 	OR rr.internalstates = 11
		  	 </if>
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
   </select>
  <insert id="addTransferRecord" parameterType="com.calculatedfun.dto.LogisticsTransfer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Jun 04 18:20:54 CST 2013.
    -->
    insert into logistics_transfer (id, transferfrom, transferto, 
      occurrencetime, type, goodsid,status
      )
    values (#{id,jdbcType=VARCHAR}, #{transferfrom,jdbcType=INTEGER}, #{transferto,jdbcType=INTEGER}, 
      #{occurrencetime,jdbcType=TIMESTAMP}, #{type,jdbcType=CHAR}, #{goodsid,jdbcType=INTEGER},#{status,jdbcType=CHAR}
      )
  </insert>
  <select id="getTransferGoodsInService_pack" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT t.goodstype,
      t.goodsno,
      t.ownid,
      t.requeststatus,
      t.goodsstatus,
      e.name as ownname,
      t.sendtype,
      t.handlingtime 
      FROM 
	  (
	  	 (
	  	  SELECT '包裹' as goodstype,
	  	  packno as goodsno,
	  	  ownid as ownid,
	  	  '-1' as requeststatus,
	  	  cutstatus as goodsstatus,
	  	  '' as sendtype,
	  	  createtime as handlingtime 
	  	  FROM logistics_pack 
	  	  WHERE packno =#{goodno,jdbcType=INTEGER}
	  	  AND cutstatus = '0' 
	  	  AND receivestatus = '0'
	  	  AND ownid = '--'
	  	)
		
	  )t 
	    LEFT JOIN employee e ON t.ownid = e.id 
	    ORDER BY t.handlingtime ASC 
	    limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsInHandling_pack" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT t.goodstype,
      t.goodsno,
      t.ownid,
      t.requeststatus,
      t.goodsstatus,
      e.name as ownname,
      t.sendtype,
      t.handlingtime 
      FROM 
	  (
	  	 (
	  	  SELECT '包裹' as goodstype,
	  	  packno as goodsno,
	  	  ownid as ownid,
	  	  '-1' as requeststatus,
	  	  cutstatus as goodsstatus,
	  	  '' as sendtype,
	  	  createtime as handlingtime 
	  	  FROM logistics_pack 
	  	  WHERE packno =#{goodno,jdbcType=INTEGER}
	  	  AND cutstatus = '0' 
	  	  AND receivestatus = '0'
	  	
	  	)
		
	  )t 
	    LEFT JOIN employee e ON t.ownid = e.id 
	    ORDER BY t.handlingtime ASC 
	    limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsListInService" resultType="com.calculatedfun.bean.TransferGoods" parameterType="java.lang.Integer">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.coinnum
		FROM
		  (
		    (SELECT 
		      '包裹' AS goodstype,
		      packno AS goodsno,
		      ownid AS ownid,
		      '-1' AS requeststatus,
		      cutstatus AS goodsstatus,
		      '' AS sendtype,
		      createtime AS handlingtime,
		      '' paydiffertime,
		      '' payinfo,
		      '' coinnum 
		    FROM
		      logistics_pack 
		    WHERE cutstatus = '0' 
		      AND receivestatus = '0' 
		      AND ownid = '--') 
		    UNION
		    ALL 
		    (SELECT 
		      '申请单' AS goodstype,
		      rr.requestcode AS goodsno,
		      rr.ownid AS ownid,
		      rr.requeststatus AS requeststatus,
		      rr.internalstates AS goodsstatus,
		      rr.sendtype AS sendtype,
		      rr.requesttime AS handlingtime,
		      TIME_TO_SEC(
		        TIMEDIFF(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          rr.duetime
		        )
		      ) * (- 1) AS paydiffertime,
		      (
			      CASE
			        WHEN rr.paystatus = '1' 
			        THEN IFNULL(
			          (SELECT 
			            DATE_FORMAT(
			              MAX(p.createdate),
			              '%Y-%m-%d %H:%i:%S'
			            ) 
			          FROM
			            pay_journal p 
			          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
			          "已支付"
			        ) 
			        ELSE "--" 
			      END
			    ) payinfo,
		      (SELECT SUM(r.amount) FROM request_detail r WHERE requestid=rr.id) coinnum 
		    FROM
		      request_main rr 
		    WHERE rr.requeststatus = '6' 
		      AND rr.delflag = '0' 
		      AND rr.sendtype = '2')
		  ) t 
		  LEFT JOIN employee e 
		    ON t.ownid = e.id 
		ORDER BY t.handlingtime ASC 
		limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsTypeInService" resultType="com.calculatedfun.bean.TransferGoods" parameterType="java.lang.Integer">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.coinnum
		FROM
		  (
		    (SELECT 
		      '包裹' AS goodstype,
		      packno AS goodsno,
		      ownid AS ownid,
		      '-1' AS requeststatus,
		      cutstatus AS goodsstatus,
		      '' AS sendtype,
		      createtime AS handlingtime,
		      '' paydiffertime,
		      '' payinfo,
		      '' coinnum 
		    FROM
		      logistics_pack 
		    WHERE cutstatus = '0' 
		      AND receivestatus = '0' 
		      AND ownid = '--') 
		    UNION
		    ALL 
		    (SELECT 
		      '申请单' AS goodstype,
		      rr.requestcode AS goodsno,
		      rr.ownid AS ownid,
		      rr.requeststatus AS requeststatus,
		      rr.internalstates AS goodsstatus,
		      rr.sendtype AS sendtype,
		      rr.requesttime AS handlingtime,
		      TIME_TO_SEC(
		        TIMEDIFF(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          rr.duetime
		        )
		      ) * (- 1) AS paydiffertime,
		      (
			      CASE
			        WHEN rr.paystatus = '1' 
			        THEN IFNULL(
			          (SELECT 
			            DATE_FORMAT(
			              MAX(p.createdate),
			              '%Y-%m-%d %H:%i:%S'
			            ) 
			          FROM
			            pay_journal p 
			          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
			          "已支付"
			        ) 
			        ELSE "--" 
			      END
			    ) payinfo,
		      (SELECT SUM(r.amount) FROM request_detail r WHERE requestid=rr.id) coinnum 
		    FROM
		      request_main rr 
		    WHERE rr.requeststatus = '6' 
		      AND rr.delflag = '0' 
		      AND rr.sendtype = '2')
		  ) t 
		  LEFT JOIN employee e 
		    ON t.ownid = e.id 
		  LEFT JOIN request_main r 
		    ON r.requestcode=goodsno
		  <if test="entityType==0">
		  where r.entitytype is null
		  </if>
		  <if test="entityType==-1">
		  where r.entitytype is not null
		  </if>
		ORDER BY t.handlingtime ASC 
		limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getCheckTransferGoodsListInService" resultType="com.calculatedfun.bean.TransferGoods" parameterType="java.lang.Integer">
  	   SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.coinnum
		FROM
		  (
		    (SELECT 
		      '包裹' AS goodstype,
		      packno AS goodsno,
		      ownid AS ownid,
		      '-1' AS requeststatus,
		      cutstatus AS goodsstatus,
		      '' AS sendtype,
		      createtime AS handlingtime,
		      '' paydiffertime,
		      '' payinfo,
		      '' coinnum 
		    FROM
		      logistics_pack 
		    WHERE cutstatus = '0' 
		      AND receivestatus = '0' 
		      AND ownid = '--') 
		    UNION
		    ALL 
		    (SELECT 
		      '申请单' AS goodstype,
		      rr.requestcode AS goodsno,
		      rr.ownid AS ownid,
		      rr.requeststatus AS requeststatus,
		      rr.internalstates AS goodsstatus,
		      rr.sendtype AS sendtype,
		      rr.requesttime AS handlingtime,
		      TIME_TO_SEC(
		        TIMEDIFF(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          rr.duetime
		        )
		      ) * (- 1) AS paydiffertime,
		      (
			      CASE
			        WHEN rr.paystatus = '1' 
			        THEN IFNULL(
			          (SELECT 
			            DATE_FORMAT(
			              MAX(p.createdate),
			              '%Y-%m-%d %H:%i:%S'
			            ) 
			          FROM
			            pay_journal p 
			          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
			          "已支付"
			        ) 
			        ELSE "--" 
			      END
			    ) payinfo,
		      (SELECT SUM(r.amount) FROM request_detail r WHERE requestid=rr.id) coinnum 
		    FROM
		      request_main rr 
		    WHERE rr.requeststatus = '6' 
		      AND rr.delflag = '0' 
		      AND rr.sendtype = '2'
		      AND rr.entitytype = #{entityType,jdbcType=VARCHAR})
		  ) t 
		  LEFT JOIN employee e 
		    ON t.ownid = e.id 
		ORDER BY t.handlingtime ASC 
		limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsInService_req" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT t.goodstype,
      t.goodsno,
      t.ownid,
      t.requeststatus,
      t.goodsstatus,
      e.name as ownname,
      t.sendtype,
      t.handlingtime,
 	  t.coinnum,
 	  t.payinfo 
      FROM 
	  (
		( 
		  SELECT '申请单' AS goodstype,
    r.requestcode AS goodsno,
    r.ownid AS ownid,
    r.requeststatus AS requeststatus,
    r.internalstates AS goodsstatus,
    r.sendtype AS sendtype,
    r.requesttime AS handlingtime,
    r.totalamount AS coinnum,
    (
      CASE
        WHEN r.paystatus = '1' 
        THEN IFNULL(
          (SELECT 
            DATE_FORMAT(
              MAX(p.createdate),
              '%Y-%m-%d %H:%i:%S'
            ) 
          FROM
            pay_journal p 
          WHERE FIND_IN_SET(p.requestcode, r.requestcode)),
          "已支付"
        ) 
        ELSE "--" 
      END
    ) payinfo 
		  FROM request_main r
		  WHERE r.requestcode = #{goodno,jdbcType=INTEGER}
		  AND r.requeststatus = '6'
		  AND delflag = '0'
		  AND sendtype = '2'
		)
	  )t 
	    LEFT JOIN employee e ON t.ownid = e.id 
	    ORDER BY t.handlingtime ASC 
	    limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsCountInService" resultType="java.lang.Integer">
      SELECT COUNT(*)
      FROM 
	  (
	  	 (
	  	  SELECT '包裹' as goodstype,
	  	  packno as goodsno,
	  	  ownid as ownid,
	  	  cutstatus as goodsstatus,
	  	  '' as sendtype,
	  	  createtime as handlingtime 
	  	  FROM logistics_pack 
	  	  WHERE cutstatus = '0'
	  	  AND receivestatus = '0'
	  	  AND ownid = '--'
	  	)
		UNION ALL 
		( 
		  SELECT '申请单' as goodstype,
		  requestcode as goodsno,
		  ownid as ownid,
		  internalstates as goodsstatus,
		  sendtype as sendtype,
		  requesttime as handlingtime
		  FROM request_main 
		  WHERE requeststatus = '6'
		  AND delflag = '0'
		  AND sendtype = '2'
		 ) 
	  )t 
	    LEFT JOIN employee e ON t.ownid = e.id  
  </select> 
  <select id="getTransferGoodsCountTypeInService" resultType="java.lang.Integer">
      SELECT COUNT(*)
      FROM 
	  (
	  	 (
	  	  SELECT '包裹' as goodstype,
	  	  packno as goodsno,
	  	  ownid as ownid,
	  	  cutstatus as goodsstatus,
	  	  '' as sendtype,
	  	  createtime as handlingtime 
	  	  FROM logistics_pack 
	  	  WHERE cutstatus = '0'
	  	  AND receivestatus = '0'
	  	  AND ownid = '--'
	  	)
		UNION ALL 
		( 
		  SELECT '申请单' as goodstype,
		  requestcode as goodsno,
		  ownid as ownid,
		  internalstates as goodsstatus,
		  sendtype as sendtype,
		  requesttime as handlingtime
		  FROM request_main 
		  WHERE requeststatus = '6'
		  AND delflag = '0'
		  AND sendtype = '2'
		  <if test="entityType==0">
		  and entitytype is null
		  </if>
		  <if test="entityType==-1">
		  and entitytype is not null
		  </if>  
		 ) 
	  )t 
	    LEFT JOIN employee e ON t.ownid = e.id
		  
  </select>       
   <select id="getCheckTransferGoodsCountInService" resultType="java.lang.Integer">
      SELECT COUNT(*)
      FROM 
	  (
	  	 (
	  	  SELECT '包裹' as goodstype,
	  	  packno as goodsno,
	  	  ownid as ownid,
	  	  cutstatus as goodsstatus,
	  	  '' as sendtype,
	  	  createtime as handlingtime 
	  	  FROM logistics_pack 
	  	  WHERE cutstatus = '0'
	  	  AND receivestatus = '0'
	  	  AND ownid = '--'
	  	)
		UNION ALL 
		( 
		  SELECT '申请单' as goodstype,
		  requestcode as goodsno,
		  ownid as ownid,
		  internalstates as goodsstatus,
		  sendtype as sendtype,
		  requesttime as handlingtime
		  FROM request_main 
		  WHERE requeststatus = '6'
		  AND delflag = '0'
		  AND sendtype = '2'
		  <if test="entityType!=0 and entityType!=-1 and entityType!=-2">
		  AND entitytype = #{entityType,jdbcType=VARCHAR}
		  </if>
		  <if test="entityType==0">
	    	and entitytype is null
	      </if>
	      <if test="entityType==-1">
	  	    and entitytype is not null
	      </if>
		 ) 
	  )t 
	    LEFT JOIN employee e ON t.ownid = e.id  
  </select>    
  <select id="getTransferGoodsListInCommon" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.duetime,
		  t.coinnum 
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    rr.duetime AS duetime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request_main rr 
		  WHERE rr.internalstates = #{status1,jdbcType=CHAR}
		  	 OR rr.internalstates = #{status2,jdbcType=CHAR} 
	  		AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  ORDER BY t.handlingtime ASC 
	  limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsTypeInCommon" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.duetime,
		  t.coinnum 
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    rr.duetime AS duetime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request_main rr 
		  WHERE rr.internalstates = 3
		  	 OR rr.internalstates = 4
	  		AND delflag = '0'
	  		
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  WHERE 1=1
	  <if test="entityType==0">
	  	    and r.entitytype is null
	 	 </if>
	 	 <if test="entityType==-1">
	  		and r.entitytype is not null
	  	 </if>
	  ORDER BY t.handlingtime ASC 
	  limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getCheckTransferGoodsListInCommon" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.duetime,
		  t.coinnum 
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    rr.duetime AS duetime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request_main rr 
		  WHERE rr.internalstates = #{status1,jdbcType=CHAR}
		  	 OR rr.internalstates = #{status2,jdbcType=CHAR} 
	  		AND delflag = '0'
	  		
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  where r.entitytype = #{entityType,jdbcType=VARCHAR}
	  ORDER BY t.handlingtime ASC 
	  limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsListInRare" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.duetime,
		  t.coinnum 
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    rr.duetime AS duetime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request_main rr 
		  WHERE rr.internalstates = #{status1,jdbcType=CHAR}
		  	 OR rr.internalstates = #{status2,jdbcType=CHAR} 
		  	 OR rr.internalstates = #{status3,jdbcType=CHAR} 
	  		AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  ORDER BY t.handlingtime ASC 
	  limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsTypeInRare" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.duetime,
		  t.coinnum 
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    rr.duetime AS duetime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request rr 
		  WHERE rr.internalstates = #{status1,jdbcType=CHAR}
		  	 OR rr.internalstates = #{status2,jdbcType=CHAR} 
		  	 OR rr.internalstates = #{status3,jdbcType=CHAR} 
	  		AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  WHERE 1=1
	  <if test="entityType==0">
	  	    and r.entitytype is null
	 	 </if>
	 	 <if test="entityType==-1">
	  		and r.entitytype is not null
	  	 </if>
	  ORDER BY t.handlingtime ASC 
	  limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getCheckTransferGoodsListInRare" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.duetime,
		  t.coinnum 
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    rr.duetime AS duetime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request_main rr 
		  WHERE rr.internalstates = #{status1,jdbcType=CHAR}
		  	 OR rr.internalstates = #{status2,jdbcType=CHAR} 
		  	 OR rr.internalstates = #{status3,jdbcType=CHAR} 
	  		AND delflag = '0'
	  		
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  where r.entitytype = #{entityType,jdbcType=VARCHAR}
	  ORDER BY t.handlingtime ASC 
	  limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsInternalstatesList" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.duetime,
		  t.coinnum 
		FROM
		  (SELECT 
		    '申请单' AS goodstype,
		    rr.requestcode AS goodsno,
		    rr.ownid AS ownid,
		    rr.requeststatus AS requeststatus,
		    rr.internalstates AS goodsstatus,
		    rr.sendtype AS sendtype,
		    rr.requesttime AS handlingtime,
		    rr.duetime AS duetime,
		    TIME_TO_SEC(
		      TIMEDIFF(
		        (SELECT 
		          DATE_FORMAT(
		            MAX(p.createdate),
		            '%Y-%m-%d %H:%i:%S'
		          ) 
		        FROM
		          pay_journal p 
		        WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		        rr.duetime
		      )
		    ) * (- 1) AS paydiffertime,
		    (
		      CASE
		        WHEN rr.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo,
		    (SELECT 
		      SUM(r.amount)
		    FROM
		      request_detail r 
		    WHERE requestid = rr.id) coinnum 
		  FROM
		    request_main rr 
		  WHERE delflag = '0' 
		  	 <if test="internalstates>0 ">
		  	 	AND rr.internalstates = #{internalstates,jdbcType=CHAR}
		  	 </if>
		  	 <if test="internalstates==-1">
		  	 	AND rr.internalstates = 3 
		  	 	OR rr.internalstates = 4
		  	 </if>
		  	 <if test="internalstates==-2">
		  	 	AND rr.internalstates = 5 
		  	 	OR rr.internalstates = 6
		  	 </if>
		  	 <if test="internalstates==-3">
		  	 	AND rr.internalstates = 7 
		  	 	OR rr.internalstates = 8
		  	 </if>
		  	 <if test="internalstates==-4">
		  	 	AND rr.internalstates = 9 
		  	 	OR rr.internalstates = 10
		  	 	OR rr.internalstates = 11
		  	 </if>
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  ORDER BY t.handlingtime ASC 
	  limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsInCommon_req" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT t.goodstype,
      t.goodsno,
      t.ownid,
      t.requeststatus,
      t.goodsstatus,
      e.name as ownname,
      t.sendtype,
      t.handlingtime,
      t.coinnum,
      t.payinfo
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	r.requestcode as goodsno,
	  	r.ownid as ownid,
	  	r.requeststatus as requeststatus,
	  	r.internalstates as goodsstatus,
	  	r.sendtype as sendtype,
		r.requesttime as handlingtime,
	  	r.totalamount AS coinnum,
	  	(
	      CASE
	        WHEN r.paystatus = '1' 
	        THEN IFNULL(
	          (SELECT 
	            DATE_FORMAT(
	              MAX(p.createdate),
	              '%Y-%m-%d %H:%i:%S'
	            ) 
	          FROM
	            pay_journal p 
	          WHERE FIND_IN_SET(p.requestcode, r.requestcode)),
	          "已支付"
	        ) 
	        ELSE "--" 
	      END
	    ) payinfo 
	  	FROM request_main r
	  	WHERE r.requestcode = #{goodno,jdbcType=INTEGER}
	  	AND (r.internalstates = #{status1,jdbcType=CHAR}
	  	OR r.internalstates = #{status2,jdbcType=CHAR} )
	  	AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  ORDER BY t.handlingtime ASC 
	  limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsInRare_req" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT t.goodstype,
      t.goodsno,
      t.ownid,
      t.requeststatus,
      t.goodsstatus,
      e.name as ownname,
      t.sendtype,
      t.handlingtime,
      t.coinnum,
      t.payinfo
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	r.requestcode as goodsno,
	  	r.ownid as ownid,
	  	r.requeststatus as requeststatus,
	  	r.internalstates as goodsstatus,
	  	r.sendtype as sendtype,
		r.requesttime as handlingtime,
	  	r.totalamount AS coinnum,
	  	(
	      CASE
	        WHEN r.paystatus = '1' 
	        THEN IFNULL(
	          (SELECT 
	            DATE_FORMAT(
	              MAX(p.createdate),
	              '%Y-%m-%d %H:%i:%S'
	            ) 
	          FROM
	            pay_journal p 
	          WHERE FIND_IN_SET(p.requestcode, r.requestcode)),
	          "已支付"
	        ) 
	        ELSE "--" 
	      END
	    ) payinfo 
	  	FROM request_main r
	  	WHERE r.requestcode = #{goodno,jdbcType=INTEGER}
	  	AND (r.internalstates = #{status1,jdbcType=CHAR}
	  	OR r.internalstates = #{status2,jdbcType=CHAR}
	  	OR r.internalstates = #{status3,jdbcType=CHAR} )
	  	AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  ORDER BY t.handlingtime ASC 
	  limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsCountInCommon" resultType="java.lang.Integer">
      SELECT COUNT(*) 
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	requestcode as goodsno,
	  	ownid as ownid,
	  	internalstates as goodsstatus,
	  	sendtype as sendtype,
		requesttime as handlingtime 
	  	FROM request_main 
	  	WHERE internalstates = #{status1,jdbcType=CHAR}
	  	OR internalstates = #{status2,jdbcType=CHAR} 
	  	AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
  </select>
  <select id="getTransferGoodsCountTypeInCommon" resultType="java.lang.Integer">
      SELECT COUNT(*) 
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	requestcode as goodsno,
	  	ownid as ownid,
	  	internalstates as goodsstatus,
	  	sendtype as sendtype,
		requesttime as handlingtime 
	  	FROM request_main 
	  	WHERE internalstates = #{status1,jdbcType=CHAR}
	  	OR internalstates = #{status2,jdbcType=CHAR} 
	  	AND delflag = '0'
	  	)t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  where 1=1 
	  <if test="entityType==0">
	  	and entitytype is null
	   </if>
	   <if test="entityType==-1">
	  	and entitytype is not null
	   </if>
	  
  </select>
  <select id="getCheckTransferGoodsCountInCommon" resultType="java.lang.Integer">
        SELECT COUNT(*) 
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	requestcode as goodsno,
	  	ownid as ownid,
	  	internalstates as goodsstatus,
	  	sendtype as sendtype,
		requesttime as handlingtime 
	  	FROM request_main 
	  	WHERE internalstates = #{status1,jdbcType=CHAR}
	  	OR internalstates = #{status2,jdbcType=CHAR} 
	  	AND delflag = '0'
	  )t
	    LEFT JOIN employee e ON t.ownid = e.id
	    LEFT JOIN request_main r ON r.requestcode=goodsno
	    WHERE 1=1
	    <if test="entityType!=0 and entityType!=-1 and entityType!=-2">
	  	and r.entitytype=#{entityType,jdbcType=VARCHAR}
	  	</if>
	  	<if test="entityType==0">
	  	and r.entitytype is null
	  	</if>
	  	<if test="entityType==-1">
	  	and r.entitytype is not null
	  	</if>
  </select>
  <select id="getCheckTransferGoodsCountInInternalstates" resultType="java.lang.Integer">
        SELECT COUNT(*) 
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	requestcode as goodsno,
	  	ownid as ownid,
	  	internalstates as goodsstatus,
	  	sendtype as sendtype,
		requesttime as handlingtime 
	  	FROM request_main 
	  	WHERE delflag = '0' 
		  	 <if test="internalstates>0 ">
		  	 	AND internalstates = #{internalstates,jdbcType=CHAR}
		  	 </if>
		  	 <if test="internalstates==-1">
		  	 	AND internalstates = 3 
		  	 	OR internalstates = 4
		  	 </if>
		  	 <if test="internalstates==-2">
		  	 	AND internalstates = 5 
		  	 	OR internalstates = 6
		  	 </if>
		  	 <if test="internalstates==-3">
		  	 	AND internalstates = 7 
		  	 	OR internalstates = 8
		  	 </if>
		  	 <if test="internalstates==-4">
		  	 	AND internalstates = 9 
		  	 	OR internalstates = 10
		  	 	OR internalstates = 11
		  	 </if>
	  )t
	    LEFT JOIN employee e ON t.ownid = e.id
	    LEFT JOIN request_main r ON r.requestcode=goodsno
  </select>
  <select id="getTransferGoodsCountInRare" resultType="java.lang.Integer">
      SELECT COUNT(*) 
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	requestcode as goodsno,
	  	ownid as ownid,
	  	internalstates as goodsstatus,
	  	sendtype as sendtype,
		requesttime as handlingtime 
	  	FROM request_main 
	  	WHERE internalstates = #{status1,jdbcType=CHAR}
	  	OR internalstates = #{status2,jdbcType=CHAR} 
	  	OR internalstates = #{status3,jdbcType=CHAR} 
	  	AND delflag = '0'
	  )t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
  </select>
  <select id="getTransferGoodsCountTypeInRare" resultType="java.lang.Integer">
      SELECT COUNT(*) 
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	requestcode as goodsno,
	  	ownid as ownid,
	  	internalstates as goodsstatus,
	  	sendtype as sendtype,
		requesttime as handlingtime 
	  	FROM request_main 
	  	WHERE internalstates = #{status1,jdbcType=CHAR}
	  	OR internalstates = #{status2,jdbcType=CHAR} 
	  	OR internalstates = #{status3,jdbcType=CHAR} 
	  	AND delflag = '0'
	  	)t
	  LEFT JOIN employee e ON t.ownid = e.id
	  LEFT JOIN request_main r ON r.requestcode=goodsno
	  where 1=1 
	  <if test="entityType==0">
	  	and entitytype is null
	   </if>
	   <if test="entityType==-1">
	  	and entitytype is not null
	   </if>
	  
  </select>
  <select id="getCheckTransferGoodsCountInRare" resultType="java.lang.Integer">
        SELECT COUNT(*) 
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	requestcode as goodsno,
	  	ownid as ownid,
	  	internalstates as goodsstatus,
	  	sendtype as sendtype,
		requesttime as handlingtime 
	  	FROM request_main 
	  	WHERE internalstates = #{status1,jdbcType=CHAR}
	  	OR internalstates = #{status2,jdbcType=CHAR} 
	  	OR internalstates = #{status3,jdbcType=CHAR} 
	  	AND delflag = '0'
	  )t
	    LEFT JOIN employee e ON t.ownid = e.id
	    LEFT JOIN request_main r ON r.requestcode=goodsno
	    WHERE 1=1
	    <if test="entityType!=0 and entityType!=-1 and entityType!=-2">
	  	and r.entitytype=#{entityType,jdbcType=VARCHAR}
	  	</if>
	  	<if test="entityType==0">
	  	and r.entitytype is null
	  	</if>
	  	<if test="entityType==-1">
	  	and r.entitytype is not null
	  	</if>
  </select>
  <select id="getTransferGoodsInternalstatesCount" resultType="java.lang.Integer">
        SELECT COUNT(*) 
      FROM
	  (
	  	SELECT '申请单' as goodstype,
	  	requestcode as goodsno,
	  	ownid as ownid,
	  	internalstates as goodsstatus,
	  	sendtype as sendtype,
		requesttime as handlingtime 
	  	FROM request_main 
	  	WHERE delflag = '0' 
		  	 <if test="internalstates>0 ">
		  	 	AND internalstates = #{internalstates,jdbcType=CHAR}
		  	 </if>
		  	 <if test="internalstates==-1">
		  	 	AND internalstates = 3 
		  	 	OR internalstates = 4
		  	 </if>
		  	 <if test="internalstates==-2">
		  	 	AND internalstates = 5 
		  	 	OR internalstates = 6
		  	 </if>
		  	 <if test="internalstates==-3">
		  	 	AND internalstates = 7 
		  	 	OR internalstates = 8
		  	 </if>
		  	 <if test="internalstates==-4">
		  	 	AND internalstates = 9 
		  	 	OR internalstates = 10
		  	 	OR internalstates = 11
		  	 </if>
	  )t
	    LEFT JOIN employee e ON t.ownid = e.id
	    LEFT JOIN request_main r ON r.requestcode=goodsno
  </select>
  <select id="getTransferGoodsListInHandling" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.coinnum
		FROM
		  (
		    (SELECT 
		      '包裹' AS goodstype,
		      packno AS goodsno,
		      ownid AS ownid,
		      '-1' AS requeststatus,
		      cutstatus AS goodsstatus,
		      '' AS sendtype,
		      createtime AS handlingtime,
		      '' paydiffertime,
		      '' payinfo,
		      '' coinnum 
		    FROM
		      logistics_pack 
		    WHERE cutstatus = '0' 
		      AND receivestatus = '0') 
		    UNION
		    ALL 
		    (SELECT 
		      '申请单' AS goodstype,
		      rr.requestcode AS goodsno,
		      rr.ownid AS ownid,
		      rr.requeststatus AS requeststatus,
		      rr.internalstates AS goodsstatus,
		      rr.sendtype AS sendtype,
		      rr.requesttime AS handlingtime,
		      TIME_TO_SEC(
		        TIMEDIFF(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          rr.duetime
		        )
		      ) * (- 1) AS paydiffertime,
		      (
			      CASE
			        WHEN rr.paystatus = '1' 
			        THEN IFNULL(
			          (SELECT 
			            DATE_FORMAT(
			              MAX(p.createdate),
			              '%Y-%m-%d %H:%i:%S'
			            ) 
			          FROM
			            pay_journal p 
			          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
			          "已支付"
			        ) 
			        ELSE "--" 
			      END
			    ) payinfo,
		      (SELECT SUM(r.amount) FROM request_detail r WHERE requestid=rr.id) coinnum 
		    FROM
		      request_main rr 
		    WHERE rr.internalstates = '1' 
		      OR rr.internalstates = '2' 
		      OR rr.internalstates = '3' 
		      AND rr.delflag = '0')
		  ) t 
		  LEFT JOIN employee e 
		    ON t.ownid = e.id LEFT JOIN request_main r ON r.requestcode=goodsno 
		ORDER BY t.handlingtime ASC 
	    limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsTypeInHandling" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.coinnum
		FROM
		  (
		    (SELECT 
		      '包裹' AS goodstype,
		      packno AS goodsno,
		      ownid AS ownid,
		      '-1' AS requeststatus,
		      cutstatus AS goodsstatus,
		      '' AS sendtype,
		      createtime AS handlingtime,
		      '' paydiffertime,
		      '' payinfo,
		      '' coinnum 
		    FROM
		      logistics_pack 
		    WHERE cutstatus = '0' 
		      AND receivestatus = '0') 
		    UNION
		    ALL 
		    (SELECT 
		      '申请单' AS goodstype,
		      rr.requestcode AS goodsno,
		      rr.ownid AS ownid,
		      rr.requeststatus AS requeststatus,
		      rr.internalstates AS goodsstatus,
		      rr.sendtype AS sendtype,
		      rr.requesttime AS handlingtime,
		      TIME_TO_SEC(
		        TIMEDIFF(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          rr.duetime
		        )
		      ) * (- 1) AS paydiffertime,
		      (
			      CASE
			        WHEN rr.paystatus = '1' 
			        THEN IFNULL(
			          (SELECT 
			            DATE_FORMAT(
			              MAX(p.createdate),
			              '%Y-%m-%d %H:%i:%S'
			            ) 
			          FROM
			            pay_journal p 
			          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
			          "已支付"
			        ) 
			        ELSE "--" 
			      END
			    ) payinfo,
		      (SELECT SUM(r.amount) FROM request_detail r WHERE requestid=rr.id) coinnum 
		    FROM
		      request_main rr 
		    WHERE rr.internalstates = '1' 
		      OR rr.internalstates = '2' 
		      OR rr.internalstates = '3' 
		      AND rr.delflag = '0')
		  ) t 
		  LEFT JOIN employee e 
		    ON t.ownid = e.id
		  LEFT JOIN request_main r ON r.requestcode=goodsno
		   <if test="entityType==0">
		  where r.entitytype is null
		  </if>
		  <if test="entityType==-1">
		  where r.entitytype is not null
		  </if>  
		ORDER BY t.handlingtime ASC 
	    limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getCheckTransferGoodsListInHandling" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT 
		  t.goodstype,
		  t.goodsno,
		  t.ownid,
		  t.requeststatus,
		  t.goodsstatus,
		  e.name AS ownname,
		  t.sendtype,
		  t.handlingtime,
		  t.paydiffertime,
		  t.payinfo,
		  t.coinnum
		FROM
		  (
		    (SELECT 
		      '包裹' AS goodstype,
		      packno AS goodsno,
		      ownid AS ownid,
		      '-1' AS requeststatus,
		      cutstatus AS goodsstatus,
		      '' AS sendtype,
		      createtime AS handlingtime,
		      '' paydiffertime,
		      '' payinfo,
		      '' coinnum 
		    FROM
		      logistics_pack 
		    WHERE cutstatus = '0' 
		      AND receivestatus = '0') 
		    UNION
		    ALL 
		    (SELECT 
		      '申请单' AS goodstype,
		      rr.requestcode AS goodsno,
		      rr.ownid AS ownid,
		      rr.requeststatus AS requeststatus,
		      rr.internalstates AS goodsstatus,
		      rr.sendtype AS sendtype,
		      rr.requesttime AS handlingtime,
		      TIME_TO_SEC(
		        TIMEDIFF(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
		          rr.duetime
		        )
		      ) * (- 1) AS paydiffertime,
		      (
			      CASE
			        WHEN rr.paystatus = '1' 
			        THEN IFNULL(
			          (SELECT 
			            DATE_FORMAT(
			              MAX(p.createdate),
			              '%Y-%m-%d %H:%i:%S'
			            ) 
			          FROM
			            pay_journal p 
			          WHERE FIND_IN_SET(p.requestcode, rr.requestcode)),
			          "已支付"
			        ) 
			        ELSE "--" 
			      END
			    ) payinfo,
		      (SELECT SUM(r.amount) FROM request_detail r WHERE requestid=rr.id) coinnum 
		    FROM
		      request_main rr 
		    WHERE rr.internalstates = '1' 
		      OR rr.internalstates = '2' 
		      OR rr.internalstates = '3' 
		      AND rr.delflag = '0'
		      )
		  ) t
		  LEFT JOIN employee e 
		    ON t.ownid = e.id LEFT JOIN request_main r ON r.requestcode=goodsno
		    WHERE r.entitytype = #{entityType,jdbcType=VARCHAR}
		ORDER BY t.handlingtime ASC 
	    limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsInHandling_req" resultType="com.calculatedfun.bean.TransferGoods">
      SELECT t.goodstype,
      t.goodsno,
      t.ownid,
      t.requeststatus,
      t.goodsstatus,
      e.name as ownname,
      t.sendtype,
      t.handlingtime,
      t.coinnum,
  	  t.payinfo 
      FROM 
	  (SELECT 
    '申请单' AS goodstype,
    r.requestcode AS goodsno,
    r.ownid AS ownid,
    r.requeststatus AS requeststatus,
    r.internalstates AS goodsstatus,
    r.sendtype AS sendtype,
    r.requesttime AS handlingtime,
    r.totalamount AS coinnum,
    (
	      CASE
	        WHEN r.paystatus = '1' 
	        THEN IFNULL(
	          (SELECT 
	            DATE_FORMAT(
	              MAX(p.createdate),
	              '%Y-%m-%d %H:%i:%S'
	            ) 
	          FROM
	            pay_journal p 
	          WHERE FIND_IN_SET(p.requestcode, r.requestcode)),
	          "已支付"
	        ) 
	        ELSE "--" 
	      END
	    ) payinfo 
	    FROM
	    request_main r 
	 	 WHERE r.requestcode = #{goodno,jdbcType=INTEGER}
	    AND (
	      r.internalstates = 1 
	      OR r.internalstates = 2 
	      OR r.internalstates = 3
	      	    ) 
	    AND delflag = '0') t 
	  	LEFT JOIN employee e 
	    ON t.ownid = e.id 
		ORDER BY t.handlingtime ASC 
	    limit #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferGoodsCountInHandling" resultType="java.lang.Integer">
      SELECT COUNT(*) 
      FROM 
	  (
	  	(
	  	  SELECT '包裹' as goodstype,
	  	  packno as goodsno,
	  	  ownid as ownid,
	  	  cutstatus as goodsstatus,
	  	  '' as sendtype,
	  	  createtime as handlingtime 
	  	  FROM logistics_pack 
	  	  WHERE cutstatus = '0' 
	  	  AND receivestatus = '0'
	  	)
		UNION ALL 
		(
		  SELECT '申请单' as goodstype,
		  requestcode as goodsno,
		  ownid as ownid,
		  internalstates as goodsstatus,
		  sendtype as sendtype,
		  requesttime as handlingtime
		  FROM request_main 
		  WHERE internalstates = '1'
		  OR internalstates = '2'
		  OR internalstates = '3'
		  AND delflag = '0'
		) 
	  )t 
	    LEFT JOIN employee e ON t.ownid = e.id
	    LEFT JOIN request_main r ON r.requestcode=goodsno
  </select>
  <select id="getTransferGoodsCountTypeInHandling" resultType="java.lang.Integer">
      SELECT COUNT(*) 
      FROM 
	  (
	  	(
	  	  SELECT '包裹' as goodstype,
	  	  packno as goodsno,
	  	  ownid as ownid,
	  	  cutstatus as goodsstatus,
	  	  '' as sendtype,
	  	  createtime as handlingtime 
	  	  FROM logistics_pack 
	  	  WHERE cutstatus = '0' 
	  	  AND receivestatus = '0'
	  	)
		UNION ALL 
		(
		  SELECT '申请单' as goodstype,
		  requestcode as goodsno,
		  ownid as ownid,
		  internalstates as goodsstatus,
		  sendtype as sendtype,
		  requesttime as handlingtime
		  FROM request_main 
		  WHERE internalstates = '1'
		  OR internalstates = '2'
		  OR internalstates = '3'
		  AND delflag = '0'
		) 
	  )t 
	    LEFT JOIN employee e ON t.ownid = e.id
	    LEFT JOIN request_main r ON r.requestcode=goodsno
		   <if test="entityType==0">
		  where r.entitytype is null
		  </if>
		  <if test="entityType==-1">
		  where r.entitytype is not null
		  </if>
  </select>
  <select id="getCheckTransferGoodsCountInHandling" resultType="java.lang.Integer">
     SELECT COUNT(*) 
      FROM 
	  (
	  	(
	  	  SELECT '包裹' AS goodstype,
	  	  packno AS goodsno,
	  	  ownid AS ownid,
	  	  cutstatus AS goodsstatus,
	  	  '' AS sendtype,
	  	  createtime AS handlingtime 
	  	  FROM logistics_pack 
	  	  WHERE cutstatus = '0' 
	  	  AND receivestatus = '0'
	  	)
		UNION ALL 
		(
		  SELECT '申请单' AS goodstype,
		  requestcode AS goodsno,
		  ownid AS ownid,
		  internalstates AS goodsstatus,
		  sendtype AS sendtype,
		  requesttime AS handlingtime
		  FROM request_main 
		  WHERE internalstates = '1'
		  OR internalstates = '2'
		  OR internalstates = '3'
		  AND delflag = '0'
		  
		) 
	  )t 
	    LEFT JOIN employee e ON t.ownid = e.id 
	    LEFT JOIN request_main r ON r.requestcode=goodsno
	    WHERE 1=1
	    <if test="entityType!=0 and entityType!=-1 and entityType!=-2">
		  AND r.entitytype = #{entityType,jdbcType=VARCHAR}
		 </if>
		 <if test="entityType==0">
	    	AND r.entitytype IS NULL
	      </if>
	      <if test="entityType==-1">
	  	    AND r.entitytype IS NOT NULL
	      </if>
  </select>
  <insert id="insertStockOutRequestRecord" parameterType="com.calculatedfun.dto.StockOut" >
    insert into stock_out (id, outby, outtime, 
      goodsid, confirmby, confirmtime, 
      type, status)
    values (#{id,jdbcType=VARCHAR}, #{outby,jdbcType=INTEGER}, #{outtime,jdbcType=TIMESTAMP}, 
      #{goodsid,jdbcType=INTEGER}, #{confirmby,jdbcType=INTEGER}, #{confirmtime,jdbcType=TIMESTAMP}, 
      #{type,jdbcType=CHAR}, #{status,jdbcType=CHAR})
  </insert>
  <insert id="insertBatchStockOutRequestRecord" parameterType="java.util.List" >
    insert into stock_out (id, outby, outtime, 
      goodsid, confirmby, confirmtime, 
      type, status)
    values 
    <foreach collection="list" item="item" index="index" separator=",">
    	(
    	#{item.id,jdbcType=VARCHAR},
    	#{item.outby,jdbcType=INTEGER},
    	#{item.outtime,jdbcType=TIMESTAMP}, 
        #{item.goodsid,jdbcType=INTEGER},
        #{item.confirmby,jdbcType=INTEGER},
        #{item.confirmtime,jdbcType=TIMESTAMP}, 
        #{item.type,jdbcType=CHAR}, 
        #{item.status,jdbcType=CHAR}
        )
     </foreach>
  </insert>
  <select id="getUserIdByCode" resultType="java.lang.String" parameterType="java.lang.Integer">
      SELECT id FROM user 
      WHERE usercode = #{usercode,jdbcType=INTEGER}
  </select>
  <update id="bindRequestByPackNo">
      update logistics_pack 
      set requestcodes = #{requestcodes,jdbcType=VARCHAR},
      customername = #{customername,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR}
      where packno = #{packno,jdbcType=INTEGER} 
  </update>
  <select id="getRequestcodesByPackNo" resultType="java.lang.String" parameterType="java.lang.Integer">
      SELECT requestcodes FROM logistics_pack
      WHERE packno = #{packno,jdbcType=INTEGER}
  </select>
  <update id="updatePackAfterUnpack">
      update logistics_pack 
      set cuttime = #{cuttime,jdbcType=TIMESTAMP},
      cutstatus = #{cutstatus,jdbcType=VARCHAR} 
      where packno = #{packno,jdbcType=INTEGER} 
  </update>
  <update id="updateRequestAfterUnpack">
      update request_main 
      set updatetime = #{updatetime,jdbcType=TIMESTAMP},
      requesttime = #{requesttime,jdbcType=TIMESTAMP},
      requeststatus = #{requeststatus,jdbcType=VARCHAR},
      internalstates = #{internalstates,jdbcType=VARCHAR},
      ownid = #{ownid,jdbcType=VARCHAR} 
      where requestcode = #{requestcode,jdbcType=INTEGER} 
  </update>
  <select id="getPackInfoByNo" resultType="com.calculatedfun.dto.LogisticsPack" parameterType="java.lang.Integer">
      <!-- select * from logistics_pack
      where packno = #{packno,jdbcType=INTEGER} -->
      
      SELECT p.id,p.packno,p.logisticsno,p.shippername,p.shippertel,p.shipperaddress,p.packstatus,p.receivestatus,p.requestcodes,p.type,
	  p.customertel,u.name as customername,p.remark,p.customerno,p.ownid,p.createtime,p.createby,p.cuttime,p.cutstatus 
	  FROM logistics_pack p LEFT JOIN user u ON p.customerno = u.usercode 
	  WHERE p.packno = #{packno,jdbcType=INTEGER}

  </select>
  <select id="getCoinInfoListByCode" resultType="com.calculatedfun.bean.CoinInfo" parameterType="java.lang.String">
		SELECT rc.id,rc.coinid,rc.coincode,rc.remark as coinremark ,rc.requestid,rcs.level ,rcs.score,rcs.remark as scoreremark,rcs.scoreby,rcs.ratingreasondis,
		i.guojia,i.years ,i.evaluate,i.amountofissue,i.mprocess,i.fullsubject,i.zhongliang,i.zhiliang,i.caizhi,i.version,i.facevalue,i.components,
		rc.difversion,rcs.scoretime,(CASE WHEN re.serviceid = 1 THEN '新评' WHEN re.serviceid = 2 THEN '重评' WHEN re.serviceid = 5 THEN
				'真品鉴定' END ) serviceid
		FROM request_coin rc LEFT JOIN request_coin_score rcs ON rc.id = rcs.requestcoinid 
		LEFT JOIN 
		(select c.years,c.id,c.evaluate,c.amountofissue,
				ExtractValue(mp.fullname, "//value[@lang='zh_CN']") as mprocess,
				ExtractValue(t.fullname, "//value[@lang='zh_CN']") as guojia,
				c.fullsubject,
				CONCAT(c.weight,ExtractValue(s.fullname, "//value[@lang='zh_CN']")) as zhongliang,
				ExtractValue(q.fullname, "//value[@lang='zh_CN']") as zhiliang,
				ExtractValue(m.fullname, "//value[@lang='zh_CN']") as caizhi,
				version,facevalue, components from coin c,sys_coin_munits s , sys_coin_mquality q ,sys_coin_mprocess mp,
				sys_coin_material m ,sys_country t
				where s.id = c.unitofmeasurement
				and q.id = c.mquality
				and m.id = c.material
				and t.id = c.country
				and mp.id = c.mprocess
		)i
		ON rc.coinid = i.id,request_main re
		WHERE rc.coincode = #{coincode,jdbcType=VARCHAR} and rc.requestid=re.id
	 	ORDER BY rcs.level,rcs.scoreby
  </select>
  <select id="getCoinInfoByCode" resultType="com.calculatedfun.bean.CoinInfo" 	>
		SELECT rc.id,rc.coinid,rc.coincode,rc.remark as coinremark ,rc.requestid,
		i.guojia,i.years ,i.evaluate,i.amountofissue,i.mprocess,i.fullsubject,i.zhongliang,i.zhiliang,i.caizhi,i.version,i.facevalue,i.components,
		rc.difversion,(CASE WHEN re.serviceid = 1 THEN '新评' WHEN re.serviceid = 2 THEN '重评' WHEN re.serviceid = 5 THEN
				'真品鉴定' END ) serviceid
		FROM request_coin rc
		LEFT JOIN 
		(select c.years,c.id,c.evaluate,c.amountofissue,
				ExtractValue(mp.fullname, "//value[@lang='zh_CN']") as mprocess,
				ExtractValue(t.fullname, "//value[@lang='zh_CN']") as guojia,
				c.fullsubject,
				CONCAT(c.weight,ExtractValue(s.fullname, "//value[@lang='zh_CN']")) as zhongliang,
				ExtractValue(q.fullname, "//value[@lang='zh_CN']") as zhiliang,
				ExtractValue(m.fullname, "//value[@lang='zh_CN']") as caizhi,
				version,facevalue, components from coin c,sys_coin_munits s , sys_coin_mquality q ,sys_coin_mprocess mp,
				sys_coin_material m ,sys_country t
				where s.id = c.unitofmeasurement
				and q.id = c.mquality
				and m.id = c.material
				and t.id = c.country
				and mp.id = c.mprocess
		)i
		ON rc.coinid = i.id,request_main re
		WHERE rc.coincode = #{coincode,jdbcType=VARCHAR} and rc.requestid=re.id	
  </select>
  <select id="getReqCoinScore" resultType="com.calculatedfun.dto.RequestCoinScore">
  		select * from request_coin_score rcs where rcs.requestcoinid=(select rc.id from request_coin rc
		where rc.coincode =#{coincode,jdbcType=VARCHAR}) 
		<if test="employeeid!=null and employeeid!=0">
			and rcs.scoreby=#{employeeid,jdbcType=INTEGER}
		</if>
		<if test="level!=null and level!=''">
			and rcs.level=#{level,jdbcType=VARCHAR}
		</if>
		order by rcs.level
  </select>
  <select id="selScoreById" resultType="java.lang.Integer">
       SELECT count(*) FROM request_coin_score 
       WHERE requestcoinid = #{requestcoinid,jdbcType=VARCHAR} 
       AND scoreby = #{employeeid,jdbcType=INTEGER}
       AND level = #{level,jdbcType=CHAR}
  </select>
  <select id="selScoreByRequestIdNotScore" resultType="java.lang.Integer">
       SELECT
			r.totalamount - count(*) 
		FROM
			request_coin_score rcs,
			request_coin rc,
			request_main r
		WHERE
			scoreby = #{employeeid,jdbcType=INTEGER}
		AND rc.id = rcs.requestcoinid
		AND rcs.`LEVEL` = #{level,jdbcType=CHAR}
		AND rc.requestid = #{requestid,jdbcType=VARCHAR} 
		AND r.id = rc.requestid
		AND (rcs.score IS NOT NULL or rcs.scores IS NOT NULL)
  </select>
  <select id="checkOnly" resultType="java.lang.Integer">
 	   SELECT COUNT(`level`) FROM request_coin_score 
 	   WHERE `level`=2 
 	   AND requestcoinid = #{requestcoinid,jdbcType=VARCHAR}
  </select>
  <update id="updateSecondCoinScore">
       UPDATE request_coin_score 
	   SET score = #{score,jdbcType=DECIMAL},
	   scores = #{scores,jdbcType=VARCHAR},
	   remark = #{remark,jdbcType=VARCHAR},
	   scoreby = #{scoreby,jdbcType=INTEGER},
	   scoretime = #{scoretime,jdbcType=TIMESTAMP},
	   ratingreasondis=#{ratingreasondis,jdbcType=VARCHAR}
	   WHERE requestcoinid = #{requestcoinid,jdbcType=VARCHAR}
	   AND `level` = 2
  </update>
  <update id="updateCoinScore">
       UPDATE request_coin_score 
	   SET score = #{score,jdbcType=DECIMAL},
	   scores = #{scores,jdbcType=VARCHAR},
	   remark = #{remark,jdbcType=VARCHAR},
	   scoretime = #{scoretime,jdbcType=TIMESTAMP},
	   ratingreasondis=#{ratingreasondis,jdbcType=VARCHAR}
	   WHERE requestcoinid = #{requestcoinid,jdbcType=VARCHAR}
	   AND scoreby = #{scoreby,jdbcType=INTEGER}
	   AND level = #{level,jdbcType=CHAR}
  </update>
  <update id="updateBillInfo">
  	update request_coin set blockNum = #{blockNum,jdbcType=VARCHAR},
  	customSize = #{customSize,jdbcType=VARCHAR},
  	difversioncode = #{difversioncode,jdbcType=INTEGER},
  	whetherSample = #{whetherSample,jdbcType=VARCHAR}
  	where id=#{requestcoinid,jdbcType=VARCHAR}
  </update>
  <update id="updateAncientCoinInfo">
  	update request_coin set weight = #{guestWRWeight,jdbcType=VARCHAR},
  	customSize = #{guestWRSize,jdbcType=VARCHAR},
  	guestWRGrade = #{guestWRGrade,jdbcType=VARCHAR}
    where id=#{requestcoinid,jdbcType=VARCHAR}
  </update>
  <update id="updateStampInfo">
  	UPDATE request_coin SET coinspecialtype=#{coinspecialtype,jdbcType=VARCHAR},
  	coinprintingpaper=#{coinprintingpaper,jdbcType=VARCHAR},customsize=#{customsize,jdbcType=VARCHAR},
  	coinmotto=#{coinmotto,jdbcType=VARCHAR},coinseriesnum=#{coinseriesnum,jdbcType=VARCHAR},
  	coincover=#{coincover,jdbcType=VARCHAR},coincovernewold=#{coincovernewold,jdbcType=VARCHAR},
  	coinpostmark=#{coinpostmark,jdbcType=VARCHAR},coinplatemode=#{coinplatemode,jdbcType=VARCHAR},
  	coinhole=#{coinhole,jdbcType=VARCHAR},coinstampjointype=#{coinstampjointype,jdbcType=INTEGER},
  	coinfullsubject=#{coinfullsubject,jdbcType=VARCHAR},
  	coinissuingquantity=#{coinissuingquantity,jdbcType=VARCHAR},coinsummary=#{coinsummary,jdbcType=VARCHAR},
  	coinfeatures=#{coinfeatures,jdbcType=VARCHAR},ratingreasondis=#{ratingreasondis,jdbcType=VARCHAR}
  	WHERE id=#{requestcoinid,jdbcType=VARCHAR}
  </update>
   <update id="updateStampInfoAll">
  	UPDATE request_coin SET coincovernewold=#{coincovernewold,jdbcType=VARCHAR},
  	coinstampjointype=#{coinstampjointype,jdbcType=INTEGER},
  	coinfullsubject=#{coinfullsubject,jdbcType=VARCHAR}
  	WHERE id=#{requestcoinid,jdbcType=VARCHAR}
  </update>
   <update id="updateMechanismCoinInfo">
  	update request_coin set weight = #{guestWRWeight,jdbcType=VARCHAR},
  	customSize = #{guestWRSize,jdbcType=VARCHAR}
    where id=#{requestcoinid,jdbcType=VARCHAR}
  </update>
  <update id="updatetagindex">
  	update request_coin rc
  	  set tagindex=(
			CASE
			WHEN EXISTS (
				SELECT
					1
				FROM
					request_main
				WHERE
					entitytype = 4
				AND id = rc.requestid
			) THEN
				CONCAT(
					rc.coincode,
					(
						SELECT
							CONCAT(
							IfNULL(ss.issuetime, ""),
							IfNULL(ss.issuedate, ""),
							IfNULL(ss.zhino, ""),
							IfNULL(ss.fullsubject, ""),
							(
								CASE
								WHEN coinnum = "1x1" THEN
									IfNULL(ss.facevaluedis, "")
								ELSE
									IfNULL(
										(
											SELECT
												dicvalue
											FROM
												sys_dictionary_data_info
											WHERE
												dictype = 'STAMP_JOIN_TYPE'
											AND dickey = coinstampjointype
										),
										CONCAT(
											IfNULL(coinstampjointype,"0"),
											"连"
										)
									)
								END
							)
						)
						FROM
							sys_stamp_basic_info ss
						WHERE
							ss.id = rc.coinid
					),
					(
						SELECT
							dicvalue
						FROM
							sys_dictionary_data_info
						WHERE
							dictype = 'COVERNEWOLD'
						AND dickey = rc.coincovernewold
					),
					IfNULL(rc.coinpostmark, "")
				)
			WHEN EXISTS (
				SELECT
					1
				FROM
					request_main
				WHERE
					entitytype = 6
				AND id = rc.requestid
			) THEN
				(
					SELECT
						fullsubject
					FROM
						sys_suit_basic_info ss
					WHERE
						ss.id = rc.coinid
				)
			ELSE
				#{tagindex,jdbcType=VARCHAR}
			END
		)
  	where id=#{requestcoinid,jdbcType=VARCHAR}
  </update>
  <insert id="insertRequestCoinScore" parameterType="com.calculatedfun.dto.RequestCoinScore" >
    insert into request_coin_score (id, requestcoinid, level, 
      score,scores, remark, scoreby, 
      scoretime,ratingreasondis)
    values (#{id,jdbcType=VARCHAR}, #{requestcoinid,jdbcType=VARCHAR}, #{level,jdbcType=CHAR}, 
      #{score,jdbcType=DECIMAL},#{scores,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}, #{scoreby,jdbcType=INTEGER}, 
      #{scoretime,jdbcType=TIMESTAMP}, #{ratingreasondis,jdbcType=VARCHAR})
  </insert>
  <update id="updateRequestCoinRemark">
   	  UPDATE request_coin 
   	  SET remark = #{remark,jdbcType=VARCHAR},
   	  difversion=#{difversion,jdbcType=VARCHAR}
	  WHERE id = #{requestcoinid,jdbcType=VARCHAR}
  </update>
  <update id="updateRequestCoinAddremarks">
   	  UPDATE request_coin 
   	  SET addremarks = #{addremarks,jdbcType=VARCHAR}
	  WHERE id = #{requestcoinid,jdbcType=VARCHAR}
  </update>
   <update id="updateRequestCoinScore">
   	  UPDATE request_coin 
   	  SET score = #{score,jdbcType=DECIMAL},
   	  scores = #{scores,jdbcType=VARCHAR},
   	  ratingreasondis=#{ratingreasondis,jdbcType=VARCHAR}
	  WHERE id = #{requestcoinid,jdbcType=VARCHAR}
  </update>
    <update id="updateBillblockNum">
   	  UPDATE request_coin set blockNum=#{blockNum,jdbcType=VARCHAR}
	  WHERE id = #{requestcoinid,jdbcType=VARCHAR}
  </update>
  <update id="updateUserDefauletMobile" parameterType="java.lang.String">
      update user
      set defaultmobile = #{number,jdbcType=VARCHAR}
      where id = #{userid,jdbcType=VARCHAR}
  </update>
    <update id="updateUserDefauletTel" parameterType="java.lang.String">
      update user
      set defaulttel = #{number,jdbcType=VARCHAR}
      where id = #{userid,jdbcType=VARCHAR}
  </update>
  <select id="getStatementListByReqCode" resultType="com.calculatedfun.bean.Statement" parameterType="java.lang.Integer">
      SELECT r.entitytype,r.requestcode,rc.coincode,rc.tagindex,rc.remark,rc.ratingreasondis,co1.shortname as coincountry,
      rd.evaluate,rd.numindex,r.usercode,r.customer,r.mobile,
      r.mail,r.serviceid,r.speed,r.totalamount,r.totalweight,r.totalpreferential,r.othercost,
      r.totalevaluate,r.totalreqcost,r.totalpremium,r.totaltransportation,
      r.totalinsurance,r.totalcost,r.sendtype,r.payment, rc.score,rc.scores,
	  ExtractValue(co.fullname, "//value[@lang='zh_CN']") as country,
	  ExtractValue(p.name, "//value[@lang='zh_CN']") as province,
	  ExtractValue(c.fullname, "//value[@lang='zh_CN']") as city,
	  ExtractValue(d.fullname, "//value[@lang='zh_CN']") as area,
	  r.address,r.paystatus,cd.amountofissue,rd.guestappraisal,rd.totalreqcost as totalcoincost,
	  rd.coinid,num.gpn as sameCoinNum
	  FROM (SELECT rc1.coincode,rc1.coinid as cid,count(*) as gpn FROM request_coin rc1 
	  LEFT JOIN request_detail rd1 ON rc1.requestid = rd1.requestid AND rc1.coinid = rd1.coinid 
	  LEFT JOIN request_main r1 ON rc1.requestid = r1.id 
	  LEFT JOIN coin cd1 ON rc1.coinid = cd1.id 
	  WHERE r1.requestcode = #{requestcode,jdbcType=INTEGER} group by rc1.coinid) num,request_coin rc 
	  LEFT JOIN request_detail rd ON rc.requestid = rd.requestid AND rc.coinid = rd.coinid 
	  LEFT JOIN request_main r ON rc.requestid = r.id 
	  LEFT JOIN sys_country co ON r.country = co.id 
	  LEFT JOIN sys_province p ON r.province = p.id 
	  LEFT JOIN sys_city c ON r.city = c.id 
	  LEFT JOIN sys_district d ON r.area = d.id 
	  LEFT JOIN coin cd ON rc.coinid = cd.id 
	  LEFT JOIN sys_country co1 on co1.id=cd.country
	  WHERE r.requestcode = #{requestcode,jdbcType=INTEGER} 
	  AND num.cid=rd.coinid
	  ORDER BY coincode ASC
  </select>
  <select id="getReqBillCoinByReqId" resultType="com.calculatedfun.bean.RequestCoinBean" parameterType="java.lang.String">
  		 SELECT * FROM request_coin where requestid=#{requestid,jdbcType=VARCHAR}
  </select>
  <select id="getStockOut" resultType="com.calculatedfun.dto.StockOut">
      SELECT * FROM stock_out 
      WHERE outby = #{outby,jdbcType=INTEGER} 
      AND type= #{type,jdbcType=CHAR} 
      AND goodsid = #{goodsid,jdbcType=INTEGER} 
      AND status = #{status,jdbcType=CHAR}
  </select>
  <select id="checkMobile" resultType="java.lang.Integer" parameterType="java.lang.String">
      SELECT COUNT(*) FROM user_mobile 
      WHERE userid = #{userid,jdbcType=VARCHAR} 
      AND telephone = #{telephone,jdbcType=VARCHAR}
      AND delflag = '0'
  </select>
  <select id="checkMail" resultType="java.lang.Integer" parameterType="java.lang.String">
      SELECT COUNT(*) FROM user_mail
      WHERE userid = #{userid,jdbcType=VARCHAR}
      AND mail = #{mail,jdbcType=VARCHAR}
      AND delflag = '0'
  </select>
  <select id="checkTel" resultType="java.lang.Integer" parameterType="java.lang.String">
      SELECT COUNT(*) FROM user_tel
      WHERE userid = #{userid,jdbcType=VARCHAR}
      AND telephone = #{telephone,jdbcType=VARCHAR}
      AND delflag = '0'
  </select>
  <resultMap id="UserMobileBaseResultMap" type="com.calculatedfun.dto.UserMobile" >
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Mon Aug 19 11:46:13 CST 2013.
			-->
		<id column="id" property="id" jdbcType="VARCHAR" />
		<result column="userid" property="userid" jdbcType="VARCHAR" />
		<result column="telephone" property="telephone" jdbcType="VARCHAR" />
		<result column="isdefault" property="isdefault" jdbcType="CHAR" />
		<result column="status" property="status" jdbcType="CHAR" />
		<result column="delflag" property="delflag" jdbcType="CHAR" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
  </resultMap>
  <select id="checkMobileApprove" resultMap="UserMobileBaseResultMap" parameterType="java.lang.String">
      SELECT * FROM user_mobile 
      WHERE 
      telephone= #{phoneno,jdbcType=VARCHAR} 
      AND status='1'
  </select>
    <select id="selectUsermobibleByname" resultMap="UserMobileBaseResultMap" parameterType="java.lang.String">
      SELECT * FROM user_mobile 
      WHERE delflag=#{delflag,jdbcType=VARCHAR}
	  and userid=#{userid,jdbcType=VARCHAR}   
	  and telephone=#{telephone,jdbcType=VARCHAR} 
  </select>
  <select id="getTransferList" resultType="com.calculatedfun.bean.HandRecord">
      SELECT l.transferfrom,l.transferto,l.type,l.goodsid,l.occurrencetime,l.status,e.`name` AS fromName,e2.`name` AS toName FROM logistics_transfer l
	  LEFT JOIN employee e ON l.transferfrom = e.id
	  LEFT JOIN employee e2 ON l.transferto = e2.id
	  WHERE 1=1
	  <if test="goodstype != null and goodstype != ''">
	      AND l.type = #{goodstype,jdbcType=CHAR}
	  </if>
	  <if test="goodsid != null and goodsid != 0">
	      AND l.goodsid = #{goodsid,jdbcType=INTEGER}
	  </if>
	  <if test="participant != null and participant != ''">
	      AND (e.`name` = #{participant,jdbcType=VARCHAR}
	  		OR e2.`name` = #{participant,jdbcType=VARCHAR})
	  </if>
	  <if test="timestart != null and timestart != ''">
	      AND l.occurrencetime &gt; #{timestart,jdbcType=TIMESTAMP}
	  </if>
	  <if test="timeend != null and timeend != ''">
	       AND l.occurrencetime &lt; #{timeend,jdbcType=TIMESTAMP}
	  </if>
	  ORDER BY l.occurrencetime DESC
	  LIMIT #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferListCount" resultType="java.lang.Integer">
      SELECT COUNT(*) FROM logistics_transfer l
	  LEFT JOIN employee e ON l.transferfrom = e.id
	  LEFT JOIN employee e2 ON l.transferto = e2.id
	  WHERE 1=1
	  <if test="goodstype != null and goodstype != ''">
	      AND l.type = #{goodstype,jdbcType=CHAR}
	  </if>
	  <if test="goodsid != null and goodsid != 0">
	      AND l.goodsid = #{goodsid,jdbcType=INTEGER}
	  </if>
	  <if test="participant != null and participant != ''">
	      AND (e.`name` = #{participant,jdbcType=VARCHAR}
	  		OR e2.`name` = #{participant,jdbcType=VARCHAR})
	  </if>
	  <if test="timestart != null and timestart != ''">
	      AND l.occurrencetime &gt; #{timestart,jdbcType=TIMESTAMP}
	  </if>
	  <if test="timeend != null and timeend != ''">
	       AND l.occurrencetime &lt; #{timeend,jdbcType=TIMESTAMP}
	  </if>
  </select>
  <select id="getTransferListById" resultType="com.calculatedfun.bean.HandRecord">
      SELECT l.transferfrom,l.transferto,l.type,l.goodsid,l.occurrencetime,l.status,e.`name` AS fromName,e2.`name` AS toName,
		  TIME_TO_SEC(
		    TIMEDIFF(
		      (SELECT 
		        DATE_FORMAT(
		          MAX(p.createdate),
		          '%Y-%m-%d %H:%i:%S'
		        ) 
		      FROM
		        pay_journal p 
		      WHERE FIND_IN_SET(p.requestcode, t.requestcode)),
		      t.duetime
		    )
		  ) * (- 1) AS paydiffertime,
		  (
		      CASE
		        WHEN t.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(p.requestcode, t.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo 
		   FROM logistics_transfer l
	  LEFT JOIN employee e ON l.transferfrom = e.id
	  LEFT JOIN employee e2 ON l.transferto = e2.id
	  LEFT JOIN request_main t ON l.goodsid = t.requestcode 
	  WHERE 1=1
	  <if test="goodstype != null and goodstype != ''">
	      AND l.type = #{goodstype,jdbcType=CHAR}
	  </if>
	  <if test="goodsid != null and goodsid != 0">
	      AND l.goodsid = #{goodsid,jdbcType=INTEGER}
	  </if>
	  <if test="participant != null and participant != 0">
	      AND (l.transferfrom = #{participant,jdbcType=INTEGER}
	  		OR l.transferto = #{participant,jdbcType=INTEGER})
	  </if>
	  <if test="timestart != null and timestart != ''">
	      AND l.occurrencetime &gt; #{timestart,jdbcType=TIMESTAMP}
	  </if>
	  <if test="timeend != null and timeend != ''">
	       AND l.occurrencetime &lt; #{timeend,jdbcType=TIMESTAMP}
	  </if>
	  ORDER BY l.occurrencetime DESC
	  LIMIT #{page,jdbcType=INTEGER} , #{pagesize,jdbcType=INTEGER}
  </select>
  <select id="getTransferListCountById" resultType="java.lang.Integer">
      SELECT COUNT(*) FROM logistics_transfer l
	  LEFT JOIN employee e ON l.transferfrom = e.id
	  LEFT JOIN employee e2 ON l.transferto = e2.id
	  WHERE 1=1
	  <if test="goodstype != null and goodstype != ''">
	      AND l.type = #{goodstype,jdbcType=CHAR}
	  </if>
	  <if test="goodsid != null and goodsid != 0">
	      AND l.goodsid = #{goodsid,jdbcType=INTEGER}
	  </if>
	  <if test="participant != null and participant != 0">
	      AND (l.transferfrom = #{participant,jdbcType=INTEGER}
	  		OR l.transferto = #{participant,jdbcType=INTEGER})
	  </if>
	  <if test="timestart != null and timestart != ''">
	      AND l.occurrencetime &gt; #{timestart,jdbcType=TIMESTAMP}
	  </if>
	  <if test="timeend != null and timeend != ''">
	       AND l.occurrencetime &lt; #{timeend,jdbcType=TIMESTAMP}
	  </if>
  </select>
  <select id="getLPBylpNo" resultType="com.calculatedfun.dto.LogisticsPack">
      SELECT * FROM logistics_pack lp
      WHERE lp.logisticsno = #{logisticsno,jdbcType=VARCHAR}
  </select>
  <select id="searchRequestList" resultType="com.calculatedfun.bean.RequestSearch">
      SELECT * FROM logistics_pack lp
      WHERE lp.logisticsno = #{logisticsno,jdbcType=VARCHAR}
  </select>
  <select id="getSendid" parameterType="java.lang.String" resultType="java.lang.String">
      SELECT sendid FROM stock 
      WHERE type = #{type,jdbcType=CHAR} 
      AND stockno = #{stockno,jdbcType=VARCHAR} 
      AND accepttime = (SELECT MAX(accepttime) FROM stock WHERE type = #{type,jdbcType=CHAR}  AND stockno = #{stockno,jdbcType=VARCHAR} );
  </select>
  <select id="getEmployeeRoles" parameterType="java.lang.String" resultType="java.lang.String">
     SELECT role FROM employee 
     WHERE id = #{employeeid,jdbcType=INTEGER}
  </select>
  <delete id="delLogin" parameterType="java.lang.String">
  	DELETE FROM user_login WHERE loginname = #{no,jdbcType=INTEGER}
  	and userid = #{userid,jdbcType=VARCHAR}
  </delete>
   <resultMap id="StockOutResultMap" type="com.calculatedfun.dto.StockOut" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 29 17:16:13 CST 2013.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="outby" property="outby" jdbcType="INTEGER" />
    <result column="outtime" property="outtime" jdbcType="TIMESTAMP" />
    <result column="goodsid" property="goodsid" jdbcType="INTEGER" />
    <result column="confirmby" property="confirmby" jdbcType="INTEGER" />
    <result column="confirmtime" property="confirmtime" jdbcType="TIMESTAMP" />
    <result column="type" property="type" jdbcType="CHAR" />
    <result column="status" property="status" jdbcType="CHAR" />
  </resultMap>
    <sql id="StockOut_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed May 29 17:16:13 CST 2013.
    -->
    id, outby, outtime, goodsid, confirmby, confirmtime, type, status
  </sql>
  <select id="getAll" resultMap="StockOutResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="StockOut_Column_List" />
    from stock_out
    where outby = #{id,jdbcType=INTEGER}
    and status='0'
  </select>
  <select id="selectUserMobileByuserid" resultType="com.calculatedfun.dto.UserMobile" >
  	select * from user_mobile
   	where 1=1 
   	<if test="userid != null and userid != ''">
   	    and userid = #{userid}
   	</if>
   </select>
   <select id="getUsercodeById" resultType="java.lang.String" parameterType="java.lang.String">
       SELECT usercode from user where id = #{id,jdbcType=VARCHAR}
   </select>
   <select id="getUsernameById" resultType="java.lang.String" parameterType="java.lang.String">
       SELECT `name` from user where id = #{id,jdbcType=VARCHAR}
   </select>
    <select id="getUserdateById" resultType="java.lang.String" parameterType="java.lang.String">
       SELECT registerdate from user where id = #{id,jdbcType=VARCHAR}
   </select>
   <select id="getUsermobileById" resultType="java.lang.String" parameterType="java.lang.String">
       SELECT defaultmobile from user where id = #{id,jdbcType=VARCHAR}
   </select>
   <select id="getUsermailById" resultType="java.lang.String" parameterType="java.lang.String">
       SELECT defaultmail from user where id = #{id,jdbcType=VARCHAR}
   </select>
   <select id="getReqForPay" resultType="com.calculatedfun.bean.ReqForPay" parameterType="java.lang.String">
       SELECT COUNT(*) as count,SUM(totalcost) as totalCost FROM request_main 
       WHERE userid = #{userid,jdbcType=VARCHAR} 
       AND requeststatus = '4' 
       AND delflag = '0'
   </select>   
   <select id="checkVersion" resultType="com.calculatedfun.dto.SysI18nData" parameterType="java.lang.String">
   		SELECT * FROM sys_i18n_data WHERE TYPE=#{type,jdbcType=VARCHAR} AND VALUE=#{version,jdbcType=VARCHAR}
   </select>
   <select id="SearchCoinByCode" resultType="java.lang.String" parameterType="java.lang.String">
   		SELECT coincode FROM request_coin where coincode=#{coincode,jdbcType=VARCHAR}
   </select>
    <select id="getRatRes" resultType="com.calculatedfun.dto.Ratingreason" parameterType="java.lang.String">
   		SELECT * FROM rating_reason 
   		WHERE reasontype=#{reasontype,jdbcType=CHAR} 
   		AND reasonname=#{reasonname,jdbcType=VARCHAR} 
   		AND reasonBelongType=#{reasonBelongType,jdbcType=CHAR} 
   		AND FLAG='1'
   </select>
   <insert id="addReqResDate" parameterType="java.lang.String">
   		 insert into request_bill_net_reason_data (requestid, requestcoinid,netreasoncode) 
   		 values (#{requestid,jdbcType=VARCHAR},#{requestcoinid,jdbcType=VARCHAR},#{netreasoncode,jdbcType=INTEGER})
   </insert>
   <delete id="delReqResDate">
   		delete from request_bill_net_reason_data where requestcoinid=#{requestcoinid,jdbcType=VARCHAR}
   </delete>
   <select id="getReasonData" resultType="com.calculatedfun.dto.RequestReasonData" parameterType="java.lang.String">
   		SELECT * FROM request_bill_net_reason_data
   		WHERE requestid=#{requestid,jdbcType=VARCHAR}
   		AND requestcoinid=#{requestcoinid,jdbcType=VARCHAR}
   		AND netreasoncode=#{netreasoncode,jdbcType=INTEGER}
   </select>
   <select id="selScores" resultType="java.lang.String">
       SELECT scores FROM request_coin_score 
       WHERE requestcoinid = #{requestcoinid,jdbcType=VARCHAR} 
       AND scoreby = #{employeeid,jdbcType=INTEGER}
       AND level = #{level,jdbcType=CHAR}
  </select>
  <select id="selScore" resultType="java.math.BigDecimal">
       SELECT score FROM request_coin_score 
       WHERE requestcoinid = #{requestcoinid,jdbcType=VARCHAR} 
       AND scoreby = #{employeeid,jdbcType=INTEGER}
       AND level = #{level,jdbcType=CHAR}
  </select>
</mapper>