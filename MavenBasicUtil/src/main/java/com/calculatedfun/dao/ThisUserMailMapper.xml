<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.calculatedfun.dao.ThisUserMailMapper" >
 
	<!-- UserMail======================================================start -->
  
	<insert id="insertUserMail" parameterType="com.calculatedfun.dto.UserMail" >
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Thu Apr 25 21:58:32 CST 2013.
			-->
    insert into user_mail (id, userid, mail, 
      isdefault, status, delflag,remark)
    values (#{id,jdbcType=VARCHAR}, #{userid,jdbcType=VARCHAR}, #{mail,jdbcType=VARCHAR}, 
      #{isdefault,jdbcType=CHAR}, #{status,jdbcType=CHAR}, #{delflag,jdbcType=CHAR},#{remark,jdbcType=VARCHAR})
	</insert>
	<select id="selectUserMailList" resultType="com.calculatedfun.dto.UserMail" parameterType="com.calculatedfun.bean.UserMailSel" >
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Fri Apr 19 11:57:10 CST 2013.
			-->
    select * from user_mail
    where 1=1
    and delflag = '0' 
		<if test="userid != null and userid != ''">
      and userid =#{userid,jdbcType=VARCHAR}
		</if>
		<if test="mail != null and mail != ''">
      and mail =#{mail,jdbcType=VARCHAR}
		</if>
		<if test="isdefault != null and isdefault != ''">
      and isdefault =#{isdefault,jdbcType=CHAR}
		</if>
		<if test="status != null and status != ''">
      and status =#{status,jdbcType=CHAR}
		</if>
		<if test="sortid != null and sortid != ''">
     order by id
		</if>
		<if test="sortuserid != null and sortuserid != ''">
     order by userid
		</if>
		<if test="sortmail != null and sortmail != ''">
     order by mail
		</if>
		<if test="sortisdefault != null and sortisdefault != ''">
     order by isdefault
		</if>
		<if test="sortstatus != null and sortstatus != ''">
     order by status
		</if>
		<if test="sortorder =='desc'">
     desc
		</if>
		<if test="sortorder == 'asc'">
     asc
		</if>
   	<!-- limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}-->
	</select>
	<select id="userMailCount" parameterType="com.calculatedfun.dto.UserMail" resultType="java.lang.Integer" >
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Fri Apr 19 11:57:10 CST 2013.
			-->
    select count(*) from user_mail
   	where 1=1 
   	and delflag = '0'
		<if test="userid != null and userid != ''">
   	    and userid = #{userid}
		</if>
		<if test="mail != null and mail != ''">
   	    and mail = #{mail,jdbcType=VARCHAR}
		</if>
		<if test="isdefault != null and isdefault != ''">
   	    and isdefault = #{isdefault,jdbcType=CHAR}
		</if>
		<if test="status != null and status != ''">
   	    and status = #{status,jdbcType=CHAR}
		</if>
	</select>
	<update id="delSelectedUserMail" parameterType="java.lang.String" >
    update user_mail 
    set delflag = '1'
    where id in 
		<foreach item="item" index="index" collection="scope"
			open="(" separator="," close=")">
    #{item}
		</foreach>
	</update>
	<update id="mUpdateCurDefaultUserMail" parameterType="java.lang.String">
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Fri Apr 19 11:57:10 CST 2013.
			-->
    UPDATE user_mail m 
    INNER JOIN user u 
    ON m.userid = u.id 
    SET m.isdefault = '1',
    u.defaultmail = m.mail 
    WHERE m.id = #{userMailId,jdbcType=VARCHAR}
    and m.userid=#{userid,jdbcType=VARCHAR}
	</update>
	<update id="mUpdateOldDefault" parameterType="java.lang.String">
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Fri Apr 19 11:57:10 CST 2013.
			-->
    UPDATE user_mail 
    SET isdefault = '0' 
    WHERE isdefault = '1' 
    AND id != #{userMailId,jdbcType=VARCHAR}
    AND userid = #{userid,jdbcType=VARCHAR}
	</update>
	<update id="mUpdateOldDefaultUserMail" parameterType="java.lang.String">
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Fri Apr 19 11:57:10 CST 2013.
			-->
    UPDATE user_mail m 
    SET m.isdefault = '0'
    WHERE m.isdefault='1'
    and m.id != #{userMailId,jdbcType=VARCHAR}
    and m.userid= #{userid,jdbcType=VARCHAR}
	</update>
	<select id="validDefaultUserMailCount" resultType="java.lang.Integer" >
    SELECT COUNT(*) FROM user_mail 
    WHERE isdefault = '1' AND delflag = '0'
    and userid= #{userid,jdbcType=VARCHAR} 
	</select>
	<update id="removeDefaultUserMail" parameterType="java.lang.String">
    UPDATE user 
    SET defaultmail = '' 
    WHERE id = #{userid,jdbcType=VARCHAR}
	</update>
	<update id="updatemailApprove" parameterType="java.lang.String" >
    update user_mail set status = '1' where userid = #{userid,jdbcType=VARCHAR} and mail=#{no,jdbcType=VARCHAR}
	</update>
	<update id="updateUserDefaultMail" parameterType="java.lang.String">
      update user
      set defaultmail=#{mail,jdbcType=VARCHAR}
      where id= #{userid,jdbcType=VARCHAR}
	</update>
	<!-- UserMail========================================================end -->
	<resultMap id="UserMailBaseResultMap" type="com.calculatedfun.dto.UserMail" >
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Sun Apr 28 14:50:47 CST 2013.
			-->
		<id column="id" property="id" jdbcType="VARCHAR" />
		<result column="mail" property="mail" jdbcType="VARCHAR" />
		<result column="status" property="status" jdbcType="CHAR" />
		<result column="isdefault" property="isdefault" jdbcType="CHAR" />
		<result column="userid" property="userid" jdbcType="VARCHAR" />
		<result column="delflag" property="delflag" jdbcType="CHAR" />
	</resultMap>
	<sql id="UserMail_Column_List" >
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Sun Apr 28 14:50:47 CST 2013.
			-->
    id, mail, status, isdefault, userid, delflag
	</sql>
	<select id="checkMailApprove" resultMap="UserMailBaseResultMap" parameterType="java.lang.String" >
		<!--
			  WARNING - @mbggenerated
			  This element is automatically generated by MyBatis Generator, do not modify.
			  This element was generated on Sun Apr 28 14:50:47 CST 2013.
			-->
    select
		<include refid="UserMail_Column_List" />
    from user_mail 
    where 
    mail= #{mailadr,jdbcType=VARCHAR} 
    AND status='1'
	</select>
<select id="selectMailByUserid" resultType="com.calculatedfun.dto.UserMail" >
	select * from user_mail
  	 	where 1=1 
		<if test="userid != null and userid != ''">
   	    and userid = #{userid}
   	    </if>
   	    </select>
</mapper>