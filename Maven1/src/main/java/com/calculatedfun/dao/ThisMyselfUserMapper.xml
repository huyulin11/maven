<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.calculatedfun.dao.ThisMyselfUserMapper" >
    <!-- UserAddress -->
 <select id="selectUserAddressList" resultType="com.calculatedfun.dto.UserAddress" parameterType="com.calculatedfun.bean.UserAddressSel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select * from user_address
    where 1=1
    and delflag = '0' 
    <if test="userid != null and userid != ''">
      and userid =#{userid,jdbcType=VARCHAR}
    </if>
    <if test="country != null and country != ''">
      and country =#{country,jdbcType=INTEGER}
    </if>
    <if test="address != null and address != ''">
      and address =#{address,jdbcType=VARCHAR}
    </if>
    <if test="province != null and province != ''">
      and province =#{province,jdbcType=INTEGER}
    </if>
    <if test="city != null and city != ''">
      and city =#{city,jdbcType=INTEGER}
    </if>
    <if test="isdefault != null and isdefault != ''">
      and isdefault =#{isdefault,jdbcType=CHAR}
    </if>
    <if test="area != null and area != ''">
      and area =#{area,jdbcType=INTEGER}
    </if>
    <if test="receiver != null and receiver != ''">
      and receiver =#{receiver,jdbcType=VARCHAR}
    </if>
    <if test="zip != null and zip != ''">
      and zip =#{zip,jdbcType=VARCHAR}
    </if>
    <if test="tel != null and tel != ''">
      and tel =#{tel,jdbcType=VARCHAR}
    </if>
    <if test="mobile != null and mobile != ''">
      and mobile =#{mobile,jdbcType=VARCHAR}
    </if>
    <if test="mail != null and mail != ''">
      and mail =#{mail,jdbcType=VARCHAR}
    </if>
    <if test="fax != null and fax != ''">
      and fax =#{fax,jdbcType=VARCHAR}
    </if>
    <if test="sortid != null and sortid != ''">
     order by id
    </if>
    <if test="sortuserid != null and sortuserid != ''">
     order by userid
    </if>
    <if test="sortcountry != null and sortcountry != ''">
     order by country
    </if>
    <if test="sortaddress != null and sortaddress != ''">
     order by address
    </if>
    <if test="sortmobile != null and sortmobile != ''">
     order by mobile
    </if>   
    <if test="sortisdefault != null and sortisdefault != ''">
     order by isdefault
    </if>
    <if test="sortreceiver != null and sortreceiver != ''">
     order by receiver
    </if>
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
<!--    	 limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER} -->
  </select>
  <select id="getUserAddressCount" parameterType="com.calculatedfun.dto.UserAddress" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select count(*) from user_address
   	where 1=1 
   	and delflag = '0'
   	<if test="userid != null and userid != ''">
   	    and userid = #{userid,jdbcType=VARCHAR}
   	</if>
    <if test="address != null and address != ''">
   	    and address = #{address,jdbcType=VARCHAR}
   	</if>
    <if test="country != null and country != ''">
   	    and country = #{country,jdbcType=INTEGER}
   	</if>
    <if test="mail != null and mail != ''">
   	    and mail = #{mail,jdbcType=VARCHAR}
   	</if>
   	<if test="tel != null and tel != ''">
   	    and tel = #{tel,jdbcType=VARCHAR}
   	</if>
   	<if test="isdefault != null and isdefault != ''">
   	    and isdefault = #{isdefault,jdbcType=CHAR}
   	</if>
   	<if test="receiver != null and receiver != ''">
   	    and receiver = #{receiver,jdbcType=VARCHAR}
   	</if>
   	<if test="mobile != null and mobile != ''">
   	    and mobile = #{mobile,jdbcType=VARCHAR}
   	</if>
   	<if test="delflag != null and delflag != ''">
   	    and delflag = #{delflag,jdbcType=CHAR}
   	</if>
  </select>
  <update id="delSelectedRow" parameterType="java.lang.String" >
    update user_address 
    set delflag = '1'
    where id in 
  <foreach item="item" index="index" collection="scope"
    open="(" separator="," close=")">
    #{item}
  </foreach>
  </update>

  <update id="updateOldDefault" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    UPDATE user_address 
    SET isdefault = '0' 
    WHERE isdefault = '1' 
    AND id != #{userAddressId,jdbcType=VARCHAR}
    and userid =#{userid,jdbcType=VARCHAR}
  </update>
    <update id="updateCurDefaultUserAddress" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    UPDATE user_address m  
    SET m.isdefault = '1'
    WHERE m.id = #{userAddressId,jdbcType=VARCHAR}
  </update>
  <update id="updateDefaultUserAddress" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    UPDATE user_address m  
    SET m.isdefault = '0'
    WHERE m.isdefault='1'
    and m.id!=#{addressid,jdbcType=VARCHAR} 
    and m.userid =#{userid,jdbcType=VARCHAR} 
  </update>
  <update id="UpdateUserDefaultAddress" parameterType="java.lang.String">
      update user
      set defaultaddress =#{addressid,jdbcType=VARCHAR}
      where id =#{userid,jdbcType=VARCHAR}
  </update>
  <select id="validDefaultUserAddressCount" resultType="java.lang.Integer" >
    SELECT COUNT(*) FROM user_address 
    WHERE isdefault = '1' AND delflag = '0' 
    and userid =#{userid,jdbcType=VARCHAR}
  </select>
  <select id="getUserAddressbyuserId" resultType="com.calculatedfun.dto.UserAddress" parameterType="java.lang.String" >
    SELECT * FROM user_address 
    WHERE isdefault = '1' 
    AND delflag = '0' 
    AND userid = #{userId,jdbcType=VARCHAR}
  </select>
    <select id="validDefaultuserAddressCount" resultType="java.lang.Integer" >
    SELECT COUNT(*) FROM user_address 
    WHERE isdefault = '1' AND delflag = '0' 
  </select>
  <update id="removeDefaultUserAddress" parameterType="java.lang.String" >
     UPDATE user 
    SET defaultaddress = '' 
    WHERE id = #{userid,jdbcType=VARCHAR}
  </update>
  <!-- WalletRemit -->
  
  <select id="selectWalletRemitList" resultType="com.calculatedfun.bean.WalletRemitSel" parameterType="com.calculatedfun.bean.WalletRemitSel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select wr.id,wr.userid,us.usercode,us.name as username,wr.remitno,wr.type,wr.amount,wr.remitdate,wr.unit,wr.remitname,wr.remitfrom,wr.remitcode,wr.remark,wr.status,wr.confirmdate,wr.confirmuserid,wr.confirmamount,wr.delflag,wr.submitdate 
	from wallet_remit wr,`user` us
	where us.id=wr.userid and wr.delflag='0'
    <if test="userid != null and userid != ''">
      and wr.userid = #{userid,jdbcType=VARCHAR}
    </if>
    <if test="type != null and type != ''">
      and wr.type =#{type,jdbcType=CHAR}
    </if>
    <if test="amount != null and amount != ''">
      and wr.amount =#{amount,jdbcType=DECIMAL}
    </if>
    <if test="remitno != null and remitno != ''">
       and wr.remitno like CONCAT('%','${remitno}','%' )
    </if>
    <if test="remitdate != null and remitdate != ''">
      and wr.remitdate =#{remitdate,jdbcType=TIMESTAMP}
    </if>
    <if test="remitname != null and remitname != ''">
      and wr.remitname =#{remitname,jdbcType=VARCHAR}
    </if>
    <if test="remitfrom != null and remitfrom != ''">
      and wr.remitfrom =#{remitfrom,jdbcType=VARCHAR}
    </if>
    <if test="remitcode != null and remitcode != ''">
      and wr.remitcode =#{remitcode,jdbcType=VARCHAR}
    </if>
    <if test="remark != null and remark != ''">
      and wr.remark =#{remark,jdbcType=VARCHAR}
    </if>
    <if test="status != null and status != ''">
      and wr.status =#{status,jdbcType=CHAR}
    </if>
    <if test="confirmuserid != null and confirmuserid != ''">
      and wr.confirmuserid =#{confirmuserid,jdbcType=VARCHAR}
    </if>
    <if test="confirmuserid != null and confirmuserid != ''">
      and wr.confirmuserid =#{confirmuserid,jdbcType=VARCHAR}
    </if>
     <if test="confirmamount != null and confirmamount != ''">
      and wr.confirmamount =#{confirmamount,jdbcType=DECIMAL}
    </if>
     <if test="delflag != null and delflag != ''">
      and wr.delflag =#{delflag,jdbcType=CHAR}
    </if>
    <if test="usercode != null and usercode != ''">
   	    and us.usercode like CONCAT('%','${usercode}','%' )
   	</if>
   	<if test="username != null and username != ''">
   	    and us.name like CONCAT('%','${username}','%' )
   	</if>
    <if test="submitdate!= null and submitdate!= ''">
    and wr.submitdate &gt;=#{submitdate,jdbcType=TIMESTAMP}
    </if>  
    <if test="submitdateend != null and submitdateend != ''">
    and wr.submitdate &lt;=#{submitdateend,jdbcType=TIMESTAMP}
    </if>
    <if test="sortid != null and sortid != ''">
     order by wr.id
    </if>
    <if test="sortuserid != null and sortuserid != ''">
     order by wr.userid
    </if>
     <if test="sortstatus != null and sortstatus != ''">
     order by wr.status
    </if>
    <if test="sorttype != null and sorttype != ''">
     order by wr.type
    </if>
    <if test="sortamount != null and sortamount != ''">
     order by wr.amount
    </if>
    <if test="sortremitno != null and sortremitno != ''">
     order by wr.remitno
    </if>   
    <if test="sortremitdate != null and sortremitdate != ''">
     order by wr.remitdate
    </if>
    <if test="sortremitname != null and sortremitname != ''">
     order by wr.remitname
    </if>
    <if test="sortconfirmdate != null and sortconfirmdate != ''">
     order by wr.confirmdate
    </if>
    <if test="sortsubmitdate != null and sortsubmitdate != ''">
     order by wr.submitdate
    </if>
    <if test="sortusercode != null and sortusercode != ''">
     order by us.usercode
    </if>
    <if test="sortusername != null and sortusername != ''">
     order by us.name
    </if>
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
   	<!-- limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}-->
  </select>
  <select id="getWalletRemitCount" parameterType="com.calculatedfun.bean.WalletRemitSel" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select count(*)
	from wallet_remit wr,`user` us
	where us.id=wr.userid and wr.delflag='0'
   	<if test="userid != null and userid != ''">
   	    and wr.userid = #{userid,jdbcType=VARCHAR}
   	</if>
    <if test="type != null and type != ''">
   	    and wr.type = #{type,jdbcType=CHAR}
   	</if>
    <if test="remitno != null and remitno != ''">
        and wr.remitno like CONCAT('%','${remitno}','%' )
   	</if>
    <if test="remitname != null and remitname != ''">
   	    and wr.remitname = #{remitname,jdbcType=VARCHAR}
   	</if>
   	<if test="remitfrom != null and remitfrom != ''">
   	    and wr.remitfrom = #{remitfrom,jdbcType=VARCHAR}
   	</if>
   	<if test="confirmuserid != null and confirmuserid != ''">
   	    and wr.confirmuserid = #{confirmuserid,jdbcType=VARCHAR}
   	</if>
   	<if test="confirmamount != null and confirmamount != ''">
   	    and wr.confirmamount = #{confirmamount,jdbcType=DECIMAL}
   	</if>
   	<if test="remitcode != null and remitcode != ''">
   	    and wr.remitcode = #{remitcode,jdbcType=VARCHAR}
   	</if>
   	<if test="remitdate != null and remitdate != ''">
   	    and wr.remitdate = #{remitdate,jdbcType=TIMESTAMP}
   	</if>
   	<if test="status != null and status != ''">
   	    and wr.status = #{status,jdbcType=CHAR}
   	</if>
   	<if test="delflag != null and delflag != ''">
   	    and wr.delflag = #{delflag,jdbcType=CHAR}
   	</if>
   	<if test="usercode != null and usercode != ''">
   	    and us.usercode like CONCAT('%','${usercode}','%' )
   	</if>
   	<if test="username != null and username != ''">
   	    and us.name like CONCAT('%','${username}','%' )
   	</if>
   	 <if test="submitdate!= null and submitdate!= ''">
    and submitdate &gt;=#{submitdate,jdbcType=TIMESTAMP}
    </if>  
    <if test="submitdateend != null and submitdateend != ''">
    and submitdate &lt;=#{submitdateend,jdbcType=TIMESTAMP}
    </if>
  </select>
    <select id="getRemitCount" parameterType="java.lang.String" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select count(*) from wallet_remit
   	where 1=1 
   	and delflag = '0' 
	and userid = #{userId,jdbcType=VARCHAR}
  </select>
  <select id="getTotalRemit" parameterType="java.lang.String" resultType="java.lang.Double" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select SUM(amount) from wallet_remit  where delflag = '0'
	and userid = #{userId,jdbcType=VARCHAR}
  </select>
      <select id="getFinancialRemitCount" parameterType="java.lang.String" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select count(*) from wallet_remit
   	where 1=1 
   	and delflag = '0'
	and status = #{status,jdbcType=CHAR}
  </select>
  <select id="getTotalFinancialRemit" parameterType="java.lang.String" resultType="java.lang.Double" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select SUM(amount) from wallet_remit
   	where 1=1 
   	and delflag = '0'
	and status = #{status,jdbcType=CHAR}
  </select>
  <update id="delSelectedRowRemit" parameterType="java.lang.String" >
    update wallet_remit 
    set delflag = '1'
    where remitno in 
  <foreach item="item" index="index" collection="scope"
    open="(" separator="," close=")">
    #{item}
  </foreach>
  </update>
  <update id="delRemit" parameterType="java.lang.String" >
      update wallet_remit 
	  set delflag = '1'
	  where remitno = #{remitno,jdbcType=INTEGER} 
  </update>
     <update id="isdisposeRemit" parameterType="java.lang.String" >
    update wallet_remit 
    set status='1'
    where remitno in 
  <foreach item="item" index="index" collection="scope"
    open="(" separator="," close=")">
    #{item}
  </foreach>
  </update>
  <update id="remitDispose" parameterType="java.lang.String" >
	update wallet_remit 
	set status='1'
	where remitno =#{remitno,jdbcType=INTEGER}
  </update>
  <update id="isconfirmRemit" parameterType="java.lang.String" >
    update wallet_remit 
    set status='2',
    confirmuserid = #{employeeid,jdbcType=VARCHAR},
    confirmdate = #{confirmdate,jdbcType=TIMESTAMP},
    confirmamount = #{confirmamount,jdbcType=DECIMAL}
    where remitno = #{remitNo,jdbcType=VARCHAR}
  </update>
  <update id="iscancelRemit" parameterType="java.lang.String" >
    update wallet_remit 
    set status='3',
    confirmuserid = #{employeeid,jdbcType=VARCHAR},
    confirmdate = #{confirmdate,jdbcType=TIMESTAMP}
    where remitno in 
  <foreach item="item" index="index" collection="scope"
    open="(" separator="," close=")">
    #{item}
  </foreach>
  </update>
  <update id="remitCancel" parameterType="java.lang.String" >
    update wallet_remit 
    set status='3',
    confirmuserid = #{employeeid,jdbcType=VARCHAR},
    confirmdate = #{confirmdate,jdbcType=TIMESTAMP}
    where remitno = #{remitno,jdbcType=INTEGER}
  </update>
  	<select id="getProvinceName"  resultType="java.lang.String" parameterType="java.lang.Integer">
		select ExtractValue(name, "//value[@lang='zh_CN']") as name from 
		sys_province where id =#{id,jdbcType=INTEGER}
	</select>
	<select id="getCityName"  resultType="java.lang.String" parameterType="java.lang.Integer">
		select ExtractValue(fullname, "//value[@lang='zh_CN']") as fullname from sys_city
		 where id =#{id,jdbcType=INTEGER}
	</select>
	<select id="getAreaName"  resultType="java.lang.String" parameterType="java.lang.Integer">
		select ExtractValue(fullname, "//value[@lang='zh_CN']") as fullname from sys_district
		 where id =#{id,jdbcType=INTEGER}
	</select>
  <!-- 
  				WalletRefund 
  -->
  <select id="selectWalletRefundList" resultType="com.calculatedfun.bean.WalletRefundSel" parameterType="com.calculatedfun.bean.WalletRefundSel" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
     select wr.mtype,wr.id,wr.userid,us.usercode,us.name as username,wr.refundno,w.balance as EWallet,wr.type,wr.amount,wr.refunddate,wr.walletid,wr.remark,wr.status,wr.confirmdate,wr.confirmuserid,wr.delflag,wr.capitalid,wr.orderdate,wr.capitalvalue 
	from wallet_refund wr,`user` us,wallet_money w
	where us.id=wr.userid and wr.delflag='0' and w.userid=us.id
	<if test="mtype != null and mtype !=''">
		and wr.mtype=#{mtype,jdbcType=INTEGER}
	</if>
    <if test="userid != null and userid != ''">
    and wr.userid =#{userid,jdbcType=VARCHAR}
    </if>
    <if test="amount != null and amount != ''">
    and wr.amount =#{amount,jdbcType=DECIMAL}
    </if>
    <if test="type != null and type != ''">
    and wr.type =#{type,jdbcType=CHAR}
    </if>
    <if test="status != null and status != ''">
    and wr.status =#{status,jdbcType=CHAR}
    </if> 
     <if test="refundno != null and refundno != ''">
        and wr.refundno like CONCAT('%','${refundno}','%' )
   	</if>
	<if test="usercode != null and usercode != ''">
   	    and us.usercode like CONCAT('%','${usercode}','%' )
   	</if>
   	<if test="username != null and username != ''">
   	    and us.name like CONCAT('%','${username}','%' )
   	</if>
   	<if test="refunddate!= null and refunddate!= ''">
    and wr.refunddate &gt;=#{refunddate,jdbcType=TIMESTAMP}
    </if>  
    <if test="refunddateend != null and refunddateend != ''">
    and wr.refunddate &lt;=#{refunddateend,jdbcType=TIMESTAMP}
    </if>  
    <if test="sortuserid != null and sortuserid != ''">
     order by wr.userid
    </if>
    <if test="sortamount != null and sortamount != ''">
     order by wr.amount
    </if>
    <if test="sorttype != null and sorttype != ''">
     order by wr.type
    </if>
    <if test="sortrefundno != null and sortrefundno != ''">
     order by wr.refundno
    </if>
    <if test="sortrefunddate != null and sortrefunddate != ''">
     order by wr.refunddate
    </if>
    <if test="sortstatus != null and sortstatus != ''">
     order by wr.status
    </if>
    <if test="sortusercode != null and sortusercode != ''">
     order by us.usercode
    </if>
    <if test="sortusername != null and sortusername != ''">
     order by us.name
    </if>
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
   	 <!--limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}-->
  </select>
  <select id="selectWalletRefundDetail" resultType="com.calculatedfun.bean.WalletRefundSel" parameterType="com.calculatedfun.bean.WalletRefundSel" >
     SELECT
		wr.id,
		wr.userid,
		us.usercode,
		us. NAME AS username,
		wr.refundno,
		w.balance AS EWallet,
		wr.type,
		wr.amount,
		wr.refunddate,
		wr.walletid,
		wr.remark,
		wr. STATUS,
		wr.confirmdate,
		wr.confirmuserid,
		wr.delflag,
		wr.capitalid,
		wr.orderdate,
		REPLACE (
			REPLACE (wr.capitalvalue, ' ', ''),
			'\t',
			''
		) capitalvalue,
		us.documenttype,
		us.documentcode,
		us.defaultmobile,
		us.defaultmail
	FROM
		wallet_refund wr,
		`user` us,
		wallet_money w
	WHERE
		us.id = wr.userid
	AND wr.delflag = '0'
	AND w.userid = us.id
	
    <if test="userid != null and userid != ''">
        and wr.userid =#{userid,jdbcType=VARCHAR}
    </if>
    <if test="amount != null and amount != ''">
        and wr.amount =#{amount,jdbcType=DECIMAL}
    </if>
    <if test="type != null and type != ''">
        and wr.type =#{type,jdbcType=CHAR}
    </if>
    <if test="status != null and status != ''">
    and wr.status =#{status,jdbcType=CHAR}
    </if> 
     <if test="refundno != null and refundno != ''">
        and wr.refundno like CONCAT('%','${refundno}','%' )
   	</if>
	<if test="usercode != null and usercode != ''">
   	    and us.usercode like CONCAT('%','${usercode}','%' )
   	</if>
   	<if test="username != null and username != ''">
   	    and us.name like CONCAT('%','${username}','%' )
   	</if>
   	<if test="refunddate!= null and refunddate!= ''">
    and wr.refunddate &gt;=#{refunddate,jdbcType=TIMESTAMP}
    </if>  
    <if test="refunddateend != null and refunddateend != ''">
    and wr.refunddate &lt;=#{refunddateend,jdbcType=TIMESTAMP}
    </if>  
    <if test="sortuserid != null and sortuserid != ''">
     order by wr.userid
    </if>
    <if test="sortamount != null and sortamount != ''">
     order by wr.amount
    </if>
    <if test="sorttype != null and sorttype != ''">
     order by wr.type
    </if>
    <if test="sortrefundno != null and sortrefundno != ''">
     order by wr.refundno
    </if>
    <if test="sortrefunddate != null and sortrefunddate != ''">
     order by wr.refunddate
    </if>
    <if test="sortstatus != null and sortstatus != ''">
     order by wr.status
    </if>
    <if test="sortusercode != null and sortusercode != ''">
     order by us.usercode
    </if>
    <if test="sortusername != null and sortusername != ''">
     order by us.name
    </if>
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
   	 <!--limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER}-->
  </select>
  <select id="getWalletRefundCount" parameterType="com.calculatedfun.bean.WalletRefundSel" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->

    select COUNT(*)
	from wallet_refund wr,`user` us
	where us.id=wr.userid and wr.delflag='0'
   	<if test="userid != null and userid != ''">
   	   and wr.userid = #{userid,jdbcType=VARCHAR}
   	</if>
    <if test="amount != null and amount != ''">
    and wr.amount =#{amount,jdbcType=DECIMAL}
    </if>
    <if test="type != null and type != ''">
    and wr.type =#{type,jdbcType=CHAR}
    </if> 
    <if test="status != null and status != ''">
    and wr.status =#{status,jdbcType=CHAR}
    </if>
    <if test="refundno != null and refundno != ''">
        and wr.refundno like CONCAT('%','${refundno}','%' )
   	</if>
	<if test="usercode != null and usercode != ''">
   	    and us.usercode like CONCAT('%','${usercode}','%' )
   	</if>
   	<if test="username != null and username != ''">
   	    and us.name like CONCAT('%','${username}','%' )
   	</if>
   	<if test="refunddate!= null and refunddate!= ''">
    and refunddate &gt;=#{refunddate,jdbcType=TIMESTAMP}
    </if>  
  </select>
  <select id="getRefundCount" parameterType="java.lang.String" resultType="java.lang.Integer" >
    select count(*) from wallet_refund
   	where 1=1
   	and delflag = '0'
   	and mtype = 0
   	and (status = 0 or status = 1)
	and userid = #{userId,jdbcType=VARCHAR}
  </select>
   <select id="getRefundCountKk" parameterType="java.lang.String" resultType="java.lang.Integer" >
    select count(*) from wallet_refund
   	where 1=1
   	and delflag = '0'
   	and mtype = 1
   	and (status = 0 or status = 1)
	and userid = #{userId,jdbcType=VARCHAR}
  </select>
  <select id="getTotalRefund" parameterType="java.lang.String" resultType="java.lang.Double" >
    select SUM(amount)
    from wallet_refund
   	where delflag = '0' 
   	and mtype = 0
   	and (status = 0 or status = 1)
	and userid = #{userId,jdbcType=VARCHAR}
  </select>
  <select id="getTotalRefundKk" parameterType="java.lang.String" resultType="java.lang.Double" >
    select SUM(amount)
    from wallet_refund
   	where delflag = '0' 
   	and mtype = 1
   	and (status = 0 or status = 1)
	and userid = #{userId,jdbcType=VARCHAR}
  </select>
  <select id="getFinancialRefundCount" parameterType="java.lang.String" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select count(*) from wallet_refund
   	where 1=1 
   	and delflag = '0' 
   	and status= #{status,jdbcType=CHAR}
  </select>
  <select id="getTotalFinancialrefund" parameterType="java.lang.String" resultType="java.lang.Double" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select SUM(amount) from wallet_refund
   	where 1=1 
   	and delflag = '0'
	and status= #{status,jdbcType=CHAR}
  </select>
  <update id="delSelectedRowRefund" parameterType="java.lang.String" >
    update wallet_refund 
    set delflag = '1'
    where refundno =#{refundno,jdbcType=INTEGER}
  </update>
   <update id="isdisposeRefund" parameterType="java.lang.String" >
    update wallet_refund 
    set status='1'
    where refundno in 
  <foreach item="item" index="index" collection="scope"
    open="(" separator="," close=")">
    #{item}
  </foreach>
  </update>
  <update id="isconfirmRefund" parameterType="java.lang.String" >
    update wallet_refund 
    set status='2'
    where refundno in 
  <foreach item="item" index="index" collection="scope"
    open="(" separator="," close=")">
    #{item}
  </foreach>
  </update>
  <update id="iscancelRefund" parameterType="java.lang.String" >
    update wallet_refund 
    set status='3'
    where refundno = #{refundno,jdbcType=VARCHAR}
  </update>    
  <select id="selectRequestList" resultType="com.calculatedfun.dto.Request" parameterType="com.calculatedfun.bean.RequestSel" >
    select t.*,
			(
		      CASE
		        WHEN t.paystatus = '1' 
		        THEN IFNULL(
		          (SELECT 
		            DATE_FORMAT(
		              MAX(p.createdate),
		              '%Y-%m-%d %H:%i:%S'
		            ) 
		          FROM
		            pay_journal p 
		          WHERE FIND_IN_SET(t.requestcode, p.requestcode)),
		          "已支付"
		        ) 
		        ELSE "--" 
		      END
		    ) payinfo from request_main t
    where 1=1
    <if test="sessionType == 0">
    and t.requeststatus not in (-1,-2)
    </if>
   <if test="sessionType == 1">
    and t.requeststatus not in (-1)
    </if>
    <if test="requeststatus != null and requeststatus != ''">
	    and t.requeststatus =#{requeststatus,jdbcType=CHAR}
    </if> 
    <if test="userid != null and userid != ''">
    	and t.userid =#{userid,jdbcType=VARCHAR}
    </if> 
    <if test="requestcode != null and requestcode != ''">
    and t.requestcode like CONCAT('%','${requestcode}','%' )
    </if> 
     <if test="entitytype != null and entitytype != '' and entitytype !='-1'">
    and t.entitytype =#{entitytype,jdbcType=VARCHAR}
    </if>   
    <if test="applytime != null and applytime != ''">
    and t.applytime &gt;=#{applytime,jdbcType=TIMESTAMP}
    </if>  
    <if test="applytimeend != null and applytimeend != ''">
    and t.applytime &lt;=#{applytimeend,jdbcType=TIMESTAMP}
    </if>
    <if test="usercode != null and usercode != ''">
    and t.usercode =#{usercode,jdbcType=INTEGER}
    </if>
    <if test="totalcost != null and totalcost != ''">
    and t.totalcost =#{totalcost,jdbcType=DECIMAL}
    </if>
    <if test="paystatus != null and paystatus != ''">
    and t.paystatus =#{paystatus,jdbcType=INTEGER}
    </if>
    <if test="sortrequesttime != null and sortrequesttime != ''">
     order by t.requesttime
    </if>
    <if test="sortid != null and sortid != ''">
     order by t.id
    </if>
    <if test="sortuserid != null and sortuserid != ''">
     order by t.userid
    </if>
    <if test="sortrequestcode != null and sortrequestcode != ''">
     order by t.requestcode
    </if>   
    <if test="sorttotalamount != null and sorttotalamount != ''">
     order by t.totalamount
    </if> 
    <if test="sortrequeststatus != null and sortrequeststatus != ''">
     order by t.requeststatus
    </if> 
    <if test="sortapplytime != null and sortapplytime != ''">
     order by t.applytime
    </if> 
    <if test="sortremark != null and sortremark != ''">
     order by t.remark
    </if> 
    <if test="sortusercode != null and sortusercode != ''">
     order by t.usercode
    </if>  
    <if test="sortcustomer != null and sortcustomer != ''">
     order by t.customer
    </if>
      <if test="sorttotalcost != null and sorttotalcost!= ''">
     order by t.totalcost
    </if>
    <if test="sortinternalstates != null and sortinternalstates != ''">
     order by t.internalstates
    </if>    
    <if test="sortorder =='desc'">
     desc
    </if>
    <if test="sortorder == 'asc'">
     asc
    </if>
    	 limit #{pagenum,jdbcType=INTEGER} , #{pageSize,jdbcType=INTEGER} 
  </select>
  <select id="getRequestCount" parameterType="com.calculatedfun.bean.RequestSel" resultType="java.lang.Integer" >
    select count(*) from request_main
   	where delflag='0' 
    <if test="userid != null and userid != ''">
    	and userid =#{userid,jdbcType=VARCHAR}
    </if> 
     <if test="sessionType == 0">
    and requeststatus not in (-1,-2)
    </if>
   <if test="sessionType == 1">
    and requeststatus not in (-1)
    </if>
   	<if test="requeststatus != null and requeststatus != ''">
    and requeststatus =#{requeststatus,jdbcType=CHAR}
    </if> 
    <if test="requestcode != null and requestcode != ''">
    and requestcode like CONCAT('%','${requestcode}','%' )
    </if>
    <if test="applytime != null and applytime != ''">
    and applytime &gt;=#{applytime,jdbcType=TIMESTAMP}
    </if>  
    <if test="applytimeend != null and applytimeend != ''">
    and applytime &lt;=#{applytimeend,jdbcType=TIMESTAMP}
    </if>
    <if test="usercode != null and usercode != ''">
    and usercode =#{usercode,jdbcType=INTEGER}
    </if>  
     <if test="paystatus != null and paystatus != ''">
    and paystatus =#{paystatus,jdbcType=INTEGER}
    </if>  
     <if test="entitytype != null and entitytype != '' and entitytype !='-1'">
    and entitytype =#{entitytype,jdbcType=VARCHAR}
    </if>    
  </select>
  
  <update id="delSelectedRowRequest" parameterType="java.lang.String" >
    update request_main 
    set requeststatus=#{delflag,jdbcType=VARCHAR}
    where requeststatus&lt;=0
      and requestcode in 
  <foreach item="item" index="index" collection="scope"
    open="(" separator="," close=")">
    #{item}
  </foreach>
  </update> 
  <update id="confirmSelectedRowRequest" >
    update request_main 
    set requeststatus='4',internalstates='3',updatetime=#{updatetime,jdbcType=TIMESTAMP},
    duetime=#{duetime,jdbcType=TIMESTAMP}
    where requeststatus ='3'
    and requestcode =#{requestcode,jdbcType=INTEGER}
  </update>
<!-- 
  <update id="paymentRequest" parameterType="java.lang.String" >
	    update request_main 
	    set requeststatus='6'
	    where id in 
	  <foreach item="item" index="index" collection="scope"
	    open="(" separator="," close=")">
	    #{item}
	  </foreach>
  </update> -->
  <select id="checkRequestcode" resultType="com.calculatedfun.dto.Request" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select * from request_main
    where delflag='0'
    and requestcode = #{requestcode,jdbcType=INTEGER}
   </select>
     <select id="selectRequestByReqcode" resultType="com.calculatedfun.dto.Request" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 19 11:57:10 CST 2013.
    -->
    select * from request_main
    where requestcode = #{requestcode,jdbcType=INTEGER}
    or id = #{requestcode,jdbcType=INTEGER}
   </select>
<!--   Pay_Request_Receive -->
  <insert id="insertPayRequestReceive" parameterType="com.calculatedfun.dto.PayRequestReceive" >
    insert into pay_request_receive
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="requestid != null" >
        requestid,
      </if>
      <if test="type != null" >
        type,
      </if>
      <if test="amount != null" >
        amount,
      </if>
      <if test="createby != null" >
        createby,
      </if>
      <if test="createtime != null" >
        createtime,
      </if>
      <if test="status != null" >
        status,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="requestid != null" >
        #{requestid,jdbcType=VARCHAR},
      </if>
      <if test="type != null" >
        #{type,jdbcType=CHAR},
      </if>
      <if test="amount != null" >
        #{amount,jdbcType=DECIMAL},
      </if>
      <if test="createby != null" >
        #{createby,jdbcType=VARCHAR},
      </if>
      <if test="createtime != null" >
        #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        #{status,jdbcType=CHAR},
      </if>
    </trim>
  </insert>
    <insert id="insertRevokeRequest" parameterType="com.calculatedfun.dto.Request" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jun 17 15:30:34 CST 2013.
    -->
    insert into revoke_request (id, requestcode, packagecode, 
      usercode, userid, boxcode, 
      customer, mobile, tel, 
      fax, mail, serviceid, 
      speed, speedext, wapper, 
      sendtype, sendmethod, receiver, 
      receivertel, receivermobile, receivermail, 
      country, province, city, 
      area, address, payment, 
      remark, totalpremium, totaltransportation, 
      totalinsurance, totalreqcost, totalcost, 
      totalweight, totalamount, totalevaluate, 
      zip, requesttime, requeststatus, 
      updatetime, delflag, internalstates, 
      imgpath, ownid, deliveryno, 
      paystatus, confirmstatus, notice, 
      applytime,applytype,othercost,costremark,duetime)
    values (#{id,jdbcType=VARCHAR}, #{requestcode,jdbcType=INTEGER}, #{packagecode,jdbcType=VARCHAR}, 
      #{usercode,jdbcType=INTEGER}, #{userid,jdbcType=VARCHAR}, #{boxcode,jdbcType=VARCHAR}, 
      #{customer,jdbcType=VARCHAR}, #{mobile,jdbcType=VARCHAR}, #{tel,jdbcType=VARCHAR}, 
      #{fax,jdbcType=VARCHAR}, #{mail,jdbcType=VARCHAR}, #{serviceid,jdbcType=CHAR}, 
      #{speed,jdbcType=CHAR}, #{speedext,jdbcType=INTEGER}, #{wapper,jdbcType=CHAR}, 
      #{sendtype,jdbcType=CHAR}, #{sendmethod,jdbcType=CHAR}, #{receiver,jdbcType=VARCHAR}, 
      #{receivertel,jdbcType=VARCHAR}, #{receivermobile,jdbcType=VARCHAR}, #{receivermail,jdbcType=VARCHAR}, 
      #{country,jdbcType=INTEGER}, #{province,jdbcType=INTEGER}, #{city,jdbcType=INTEGER}, 
      #{area,jdbcType=INTEGER}, #{address,jdbcType=VARCHAR}, #{payment,jdbcType=VARCHAR}, 
      #{remark,jdbcType=VARCHAR}, #{totalpremium,jdbcType=DECIMAL}, #{totaltransportation,jdbcType=DECIMAL}, 
      #{totalinsurance,jdbcType=DECIMAL}, #{totalreqcost,jdbcType=DECIMAL}, #{totalcost,jdbcType=DECIMAL}, 
      #{totalweight,jdbcType=DECIMAL}, #{totalamount,jdbcType=INTEGER}, #{totalevaluate,jdbcType=DECIMAL}, 
      #{zip,jdbcType=VARCHAR}, #{requesttime,jdbcType=TIMESTAMP}, #{requeststatus,jdbcType=CHAR}, 
      #{updatetime,jdbcType=TIMESTAMP}, #{delflag,jdbcType=CHAR}, #{internalstates,jdbcType=CHAR}, 
      #{imgpath,jdbcType=VARCHAR}, #{ownid,jdbcType=VARCHAR}, #{deliveryno,jdbcType=VARCHAR}, 
      #{paystatus,jdbcType=CHAR}, #{confirmstatus,jdbcType=CHAR}, #{notice,jdbcType=CHAR}, 
      #{applytime,jdbcType=TIMESTAMP},#{applytype,jdbcType=CHAR},#{othercost,jdbcType=DECIMAL},
      #{costremark,jdbcType=VARCHAR},#{duetime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="addDelRequest" parameterType="java.lang.String">
  	insert into del_request select null,#{employeeid,jdbcType=INTEGER},r.* from request_main r where requestcode=#{requestcode,jdbcType=INTEGER}
  </insert>
  <delete id="delRequest">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue May 07 11:36:55 CST 2013.
    -->
    delete from request_main
    where requestcode = #{requestcode,jdbcType=INTEGER}
  </delete>
  <select id="getWalletRemit" resultType="com.calculatedfun.dto.WalletRemit" parameterType="java.lang.Integer">
  	 select * from wallet_remit where remitno= #{remitno,jdbcType=INTEGER}
  </select>

</mapper>