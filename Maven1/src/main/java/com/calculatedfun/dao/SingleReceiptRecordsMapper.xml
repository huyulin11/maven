<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.calculatedfun.dao.SingleReceiptRecordsMapper">
	<resultMap id="BaseResultMap" type="com.calculatedfun.dto.SingleReceiptRecords">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jul 15 
			15:52:09 CST 2014. -->
		<id column="id" property="id" jdbcType="VARCHAR" />
		<result column="requestcode" property="requestcode" jdbcType="INTEGER" />
		<result column="resetreason" property="resetreason" jdbcType="VARCHAR" />
		<result column="causeoferror" property="causeoferror" jdbcType="VARCHAR" />
		<result column="rightreasons" property="rightreasons" jdbcType="VARCHAR" />
		<result column="appreseter" property="appreseter" jdbcType="INTEGER" />
		<result column="appresettime" property="appresettime" jdbcType="TIMESTAMP" />
		<result column="dealer" property="dealer" jdbcType="INTEGER" />
		<result column="dealtime" property="dealtime" jdbcType="TIMESTAMP" />
		<result column="dealremarks" property="dealremarks" jdbcType="VARCHAR" />
		<result column="feedback" property="feedback" jdbcType="VARCHAR" />
		<result column="dealtype" property="dealtype" jdbcType="CHAR" />
		<result column="state" property="state" jdbcType="CHAR" />
		<result column="serialnumber" property="serialnumber" jdbcType="INTEGER" />
		<result column="ownid" property="ownid" jdbcType="INTEGER" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jul 15 
			15:52:09 CST 2014. -->
		id, requestcode, resetreason, causeoferror, rightreasons, appreseter,
		appresettime,
		dealer, dealtime, dealremarks, feedback, dealtype, state,
		serialnumber,ownid
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jul 15 
			15:52:09 CST 2014. -->
		select
		<include refid="Base_Column_List" />
		from single_receipt_records
		where id = #{id,jdbcType=VARCHAR}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.String">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jul 15 
			15:52:09 CST 2014. -->
		delete from single_receipt_records
		where id = #{id,jdbcType=VARCHAR}
	</delete>
	<insert id="insert" parameterType="com.calculatedfun.dto.SingleReceiptRecords">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jul 15 
			15:52:09 CST 2014. -->
		insert into single_receipt_records (id, requestcode, resetreason,
		causeoferror, rightreasons, appreseter,
		appresettime, dealer, dealtime,
		dealremarks, feedback, dealtype,
		state, serialnumber)
		values
		(#{id,jdbcType=VARCHAR}, #{requestcode,jdbcType=INTEGER},
		#{resetreason,jdbcType=VARCHAR},
		#{causeoferror,jdbcType=VARCHAR},
		#{rightreasons,jdbcType=VARCHAR}, #{appreseter,jdbcType=INTEGER},
		#{appresettime,jdbcType=TIMESTAMP}, #{dealer,jdbcType=INTEGER},
		#{dealtime,jdbcType=TIMESTAMP},
		#{dealremarks,jdbcType=VARCHAR},
		#{feedback,jdbcType=VARCHAR}, #{dealtype,jdbcType=CHAR},
		#{state,jdbcType=CHAR}, #{serialnumber,jdbcType=INTEGER})
	</insert>
	<insert id="insertSelective" parameterType="com.calculatedfun.dto.SingleReceiptRecords">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jul 15 
			15:52:09 CST 2014. -->
		insert into single_receipt_records
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="requestcode != null">
				requestcode,
			</if>
			<if test="resetreason != null">
				resetreason,
			</if>
			<if test="causeoferror != null">
				causeoferror,
			</if>
			<if test="rightreasons != null">
				rightreasons,
			</if>
			<if test="appreseter != null">
				appreseter,
			</if>
			<if test="appresettime != null">
				appresettime,
			</if>
			<if test="dealer != null">
				dealer,
			</if>
			<if test="dealtime != null">
				dealtime,
			</if>
			<if test="dealremarks != null">
				dealremarks,
			</if>
			<if test="feedback != null">
				feedback,
			</if>
			<if test="dealtype != null">
				dealtype,
			</if>
			<if test="state != null">
				state,
			</if>
			<if test="serialnumber != null">
				serialnumber,
			</if>
			<if test="ownid != null">
				ownid,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=VARCHAR},
			</if>
			<if test="requestcode != null">
				#{requestcode,jdbcType=INTEGER},
			</if>
			<if test="resetreason != null">
				#{resetreason,jdbcType=VARCHAR},
			</if>
			<if test="causeoferror != null">
				#{causeoferror,jdbcType=VARCHAR},
			</if>
			<if test="rightreasons != null">
				#{rightreasons,jdbcType=VARCHAR},
			</if>
			<if test="appreseter != null">
				#{appreseter,jdbcType=INTEGER},
			</if>
			<if test="appresettime != null">
				#{appresettime,jdbcType=TIMESTAMP},
			</if>
			<if test="dealer != null">
				#{dealer,jdbcType=INTEGER},
			</if>
			<if test="dealtime != null">
				#{dealtime,jdbcType=TIMESTAMP},
			</if>
			<if test="dealremarks != null">
				#{dealremarks,jdbcType=VARCHAR},
			</if>
			<if test="feedback != null">
				#{feedback,jdbcType=VARCHAR},
			</if>
			<if test="dealtype != null">
				#{dealtype,jdbcType=CHAR},
			</if>
			<if test="state != null">
				#{state,jdbcType=CHAR},
			</if>
			<if test="serialnumber != null">
				#{serialnumber,jdbcType=INTEGER},
			</if>
			<if test="ownid != null">
				#{ownid,jdbcType=INTEGER},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.calculatedfun.dto.SingleReceiptRecords">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jul 15 
			15:52:09 CST 2014. -->
		update single_receipt_records
		<set>
			<if test="requestcode != null">
				requestcode = #{requestcode,jdbcType=INTEGER},
			</if>
			<if test="resetreason != null">
				resetreason = #{resetreason,jdbcType=VARCHAR},
			</if>
			<if test="causeoferror != null">
				causeoferror = #{causeoferror,jdbcType=VARCHAR},
			</if>
			<if test="rightreasons != null">
				rightreasons = #{rightreasons,jdbcType=VARCHAR},
			</if>
			<if test="appreseter != null">
				appreseter = #{appreseter,jdbcType=INTEGER},
			</if>
			<if test="appresettime != null">
				appresettime = #{appresettime,jdbcType=TIMESTAMP},
			</if>
			<if test="dealer != null">
				dealer = #{dealer,jdbcType=INTEGER},
			</if>
			<if test="dealtime != null">
				dealtime = #{dealtime,jdbcType=TIMESTAMP},
			</if>
			<if test="dealremarks != null">
				dealremarks = #{dealremarks,jdbcType=VARCHAR},
			</if>
			<if test="feedback != null">
				feedback = #{feedback,jdbcType=VARCHAR},
			</if>
			<if test="dealtype != null">
				dealtype = #{dealtype,jdbcType=CHAR},
			</if>
			<if test="state != null">
				state = #{state,jdbcType=CHAR},
			</if>
			<if test="serialnumber != null">
				serialnumber = #{serialnumber,jdbcType=INTEGER},
			</if>
		</set>
		where id = #{id,jdbcType=VARCHAR}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.calculatedfun.dto.SingleReceiptRecords">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Jul 15 
			15:52:09 CST 2014. -->
		update single_receipt_records
		set requestcode =
		#{requestcode,jdbcType=INTEGER},
		resetreason =
		#{resetreason,jdbcType=VARCHAR},
		causeoferror =
		#{causeoferror,jdbcType=VARCHAR},
		rightreasons =
		#{rightreasons,jdbcType=VARCHAR},
		appreseter =
		#{appreseter,jdbcType=INTEGER},
		appresettime =
		#{appresettime,jdbcType=TIMESTAMP},
		dealer =
		#{dealer,jdbcType=INTEGER},
		dealtime = #{dealtime,jdbcType=TIMESTAMP},
		dealremarks = #{dealremarks,jdbcType=VARCHAR},
		feedback =
		#{feedback,jdbcType=VARCHAR},
		dealtype = #{dealtype,jdbcType=CHAR},
		state = #{state,jdbcType=CHAR},
		serialnumber =
		#{serialnumber,jdbcType=INTEGER}
		where id = #{id,jdbcType=VARCHAR}
	</update>
	<select id="selectBackRequest" resultType="com.calculatedfun.bean.BackRequest"
		parameterType="java.util.Map">
		SELECT
			srr.requestcode,
			r.customer,
			r.mobile,
			srr.resetreason,
			srr.appreseter,
			e. NAME AS appresetername,
			srr.appresettime,
			srr.dealer,
			e2. NAME AS dealername,
			srr.state,
			srr.ownid,
			u.defaultmobile,
			u.defaultmail,
			r.requeststatus,
			srr.dealtime
		FROM
			request_main r
		RIGHT JOIN single_receipt_records srr ON r.requestcode = srr.requestcode
		LEFT JOIN employee e ON e.id = srr.appreseter
		LEFT JOIN employee e2 ON e2.id = srr.dealer
		LEFT JOIN USER u ON u.id = r.userid
		WHERE
			1 = 1
		<if test="requestcode!=0">
			and srr.requestcode=#{requestcode,jdbcType=VARCHAR}
		</if>
		<if test="guestMobile!='' and guestMobile!=null">
			and r.mobile like #{guestMobile,jdbcType=VARCHAR}
		</if>
		<if test="guestName!='' and guestName!=null">
			and u.name = #{guestName,jdbcType=VARCHAR}
		</if>
		<if test="guestCode!='' and guestCode!=null">
			and r.usercode= #{guestCode,jdbcType=VARCHAR}
		</if>
		<if test="dealState!=-1">
			and srr.state= #{dealState,jdbcType=VARCHAR}
		</if>
		order by srr.appresettime desc
		LIMIT
		#{page,jdbcType=INTEGER},#{pagesize,jdbcType=INTEGER}
	</select>
	<select id="selectAll" resultType="java.lang.Integer"
		parameterType="java.util.Map">
		select count(*) from request_main r
		right join single_receipt_records srr on
		r.requestcode=srr.requestcode
		left join employee e on
		e.id=srr.appreseter
		left join employee e2 on e2.id=srr.dealer
		left join
		user u on u.id=r.userid
		where 1=1
		<if test="requestcode!=0">
			and srr.requestcode=#{requestcode,jdbcType=VARCHAR}
		</if>
		<if test="guestMobile!='' and guestMobile!=null">
			and r.mobile like #{guestMobile,jdbcType=VARCHAR}
		</if>
		<if test="guestName!='' and guestName!=null">
			and u.name = #{guestName,jdbcType=VARCHAR}
		</if>
		<if test="guestCode!='' and guestCode!=null">
			and r.usercode= #{guestCode,jdbcType=VARCHAR}
		</if>
		<if test="dealState!=-1">
			and srr.state= #{dealState,jdbcType=VARCHAR}
		</if>
	</select>
	<select id="getSingleReceiptRecordsByReqcode" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from single_receipt_records
		where requestcode =
		#{requestcode,jdbcType=INTEGER}
		and state != '3'
		and dealtype='2'
		order
		by appresettime desc limit 0,1
	</select>
	<select id="getSRRByReqcode" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from single_receipt_records
		where requestcode =
		#{requestcode,jdbcType=INTEGER}
		and dealtype='2'
		order by serialnumber
		desc limit 0,1
	</select>
	<select id="getRevokeSRRByReqcode" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from single_receipt_records
		where requestcode =
		#{requestcode,jdbcType=INTEGER}
		and dealtype='1'
	</select>
	<update id="updateBackReqState" parameterType="com.calculatedfun.dto.SingleReceiptRecords">
		update
		single_receipt_records
		set state ='2'
		where requestcode =
		#{requestcode,jdbcType=INTEGER}
		AND state != '3'
	</update>
	<update id="updateBackReqowner" parameterType="com.calculatedfun.dto.SingleReceiptRecords">
		update
		single_receipt_records
		set ownid = #{operater,jdbcType=INTEGER}
		where
		requestcode = #{requestcode,jdbcType=INTEGER}
		AND state != '3'
	</update>
	<update id="updateSRR" parameterType="com.calculatedfun.dto.SingleReceiptRecords">
		update
		single_receipt_records
		set resetreason =
		#{resetreason,jdbcType=VARCHAR},
		causeoferror =
		#{causeoferror,jdbcType=VARCHAR},
		rightreasons =
		#{rightreasons,jdbcType=VARCHAR},
		dealer = #{dealer,jdbcType=INTEGER},
		dealtime = #{dealtime,jdbcType=TIMESTAMP},
		dealremarks =
		#{dealremarks,jdbcType=VARCHAR},
		feedback =
		#{feedback,jdbcType=VARCHAR},
		state ='3',dealresult='1'
		where id =
		#{id,jdbcType=INTEGER}
		AND state != '3'
	</update>
	<update id="notback" parameterType="com.calculatedfun.dto.SingleReceiptRecords">
		update single_receipt_records
		set dealer = #{dealer,jdbcType=INTEGER},
		dealtime =
		#{dealtime,jdbcType=TIMESTAMP},
		dealremarks =
		#{dealremarks,jdbcType=VARCHAR},
		feedback =
		#{feedback,jdbcType=VARCHAR},
		state ='3',dealresult='2'
		where
		requestcode = #{requestcode,jdbcType=INTEGER}
	</update>
	<select id="getEmpById" resultType="com.calculatedfun.dto.Employee"
		parameterType="java.lang.Integer">
		SELECT * FROM employee
		WHERE id = #{id,jdbcType=INTEGER}
	</select>
</mapper>